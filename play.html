<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>í¼ì¦ í”Œë ˆì´ | ì‹­ìê°€ë¡œì„¸ë¡œ</title>
  <meta name="description" content="ì§€ê¸ˆ ë°”ë¡œ ì„±ê²½ ë§ì”€ì„ í¼ì¦ë¡œ í’€ì–´ë³´ì„¸ìš”. ì •ë‹µ í™•ì¸ê³¼ ì¸ì‡„ ê¸°ëŠ¥ë„ ì œê³µí•©ë‹ˆë‹¤.">
  <meta name="keywords" content="ì˜¨ë¼ì¸ ì„±ê²½í¼ì¦, ì„±ê²½ í¼ì¦ ë¬´ë£Œ, ì„±ê²½ í¼ì¦ ë§Œë“¤ê¸°">
  <meta property="og:title" content="ì‹­ìê°€ë¡œì„¸ë¡œ | ë§ì”€ ê°€ë¡œì„¸ë¡œ í¼ì¦">
  <meta property="og:description" content="ë§¤ì£¼ ìƒˆë¡œìš´ ë§ì”€ìœ¼ë¡œ ì¦ê¸°ëŠ” ì„±ê²½ í¼ì¦ ê²Œì„">
  <meta property="og:image" content="https://crossero.com/images/og-image.png">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://crossero.com">

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0717185892763061"
     crossorigin="anonymous"></script>

<script src="data.js"></script>
<script src="data_bible_extra.js"></script>
<script>
  // BIBLE.csvì—ì„œ ì¶”ì¶œí•œ ì¶”ê°€ ë‹¨ì–´ë¥¼ ê° í€´ì¦ˆ allWordsì— ë³‘í•© (í¼ì¦ í’ì„±í™”)
  if (typeof BIBLE_EXTRA_WORDS !== 'undefined' && typeof QUIZ_DATABASE !== 'undefined') {
    for (var k in QUIZ_DATABASE) {
      var arr = QUIZ_DATABASE[k].allWords;
      var existing = {}; // í€´ì¦ˆë§ˆë‹¤ í•´ë‹¹ í€´ì¦ˆì˜ ê¸°ì¡´ allWordsë§Œìœ¼ë¡œ ì±„ì›€
      for (var i = 0; i < arr.length; i++) { existing[arr[i].answer] = true; }
      if (BIBLE_EXTRA_WORDS[k]) {
        for (var j = 0; j < BIBLE_EXTRA_WORDS[k].length; j++) {
          var w = BIBLE_EXTRA_WORDS[k][j];
          if (!existing[w.answer]) { arr.push(w); existing[w.answer] = true; }
        }
      }
    }
  }
</script>
<script src="auth.js"></script>
<script src="aeo_summaries.js"></script>

<script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "vin36biyig");
</script>

<style>
/* 1. ê¸°ë³¸ ë°°ê²½ ë° í°íŠ¸ */
body {
  margin: 0;
  font-family: -apple-system, Pretendard, sans-serif;
  background: #f5f5f5;
}

/* 2. ë„¤ë¹„ê²Œì´ì…˜ ë° í—¤ë” */
.nav {
  display: flex;
  justify-content: center;
  gap: 10px;
  background: #fff;
  border-bottom: 1px solid #e5e5e5;
  padding: 12px 0;
}
.nav-item {
  padding: 8px 14px;
  font-size: 14px;
  color: #444;
  text-decoration: none;
  border-radius: 6px;
}
.nav-item:hover { background: #f0f6ff; color: #0073e6; }
.nav-active {
  background: #0073e6;
  color: #fff !important;
  font-weight: 600;
}
header {
  background: #fff;
  border-bottom: 1px solid #ddd;
  text-align: center;
  padding: 20px;
}
header img { max-width: 200px; width: 200px; }

/* 3. ë©”ì¸ ë ˆì´ì•„ì›ƒ */
main {
  max-width: 1100px;
  margin: 20px auto;
  padding: 0 20px;
  display: flex;
  gap: 25px;
  align-items: flex-start;
}
.game-area {
  flex: 0 0 450px;
}
.panel-container {
  flex: 1;
  display: flex;
  flex-direction: column;
}
.panel {
  background: #fff;
  border: 1px solid #ddd;
  padding: 20px;
  border-radius: 8px;
  height: 512px;
  overflow-y: scroll; /* â­ auto â†’ scrollë¡œ ë³€ê²½í•˜ì—¬ ìŠ¤í¬ë¡¤ë°” í•­ìƒ í‘œì‹œ */
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  margin-top: 10px;
}

/* â­ ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ (ë” ì˜ ë³´ì´ê²Œ) */
.panel::-webkit-scrollbar {
  width: 12px;
}
.panel::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 8px;
}
.panel::-webkit-scrollbar-thumb {
  background: #0073e6;
  border-radius: 8px;
}
.panel::-webkit-scrollbar-thumb:hover {
  background: #005bb7;
}

/* â­ ëª¨ë°”ì¼ ë°˜ì‘í˜•: í¼ì¦ ì•„ë˜ì— íŒíŠ¸ ë°°ì¹˜ */
@media (max-width: 768px) {
  .nav { padding: 8px 6px; gap: 6px; }
  .nav-item { padding: 6px 10px; font-size: 12px; }
  header { padding: 16px 12px; }
  header img { max-width: 160px; width: 160px; }
  main {
    flex-direction: column;
    align-items: stretch;
    padding: 0 10px;
    gap: 12px;
    margin: 10px auto;
  }
  .game-area {
    flex: none;
    width: 100%;
  }
  .panel-container {
    width: 100%;
  }
  /* ìº”ë²„ìŠ¤: í™”ë©´ ê½‰ ì±„ìš°ê¸° (ì¢Œí‘œ ê³„ì‚°ì€ JSì—ì„œ ë³´ì •) */
  canvas#puzzle {
    width: 100% !important;
    height: auto !important;
    aspect-ratio: 1 / 1;
    touch-action: pan-y; /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ì€ í—ˆìš©, ê°€ë¡œë§Œ ì°¨ë‹¨ */
  }
  /* íŒíŠ¸ íŒ¨ë„: ê³ ì • ë†’ì´ ì œê±°, ìì—°ìŠ¤ëŸ½ê²Œ í¼ì³ì§ */
  .panel {
    height: auto !important;
    max-height: none !important;
    overflow-y: visible !important;
  }
  /* ê°€ë¡œ/ì„¸ë¡œ íŒíŠ¸ë¥¼ ë‚˜ë€íˆ 2ì—´ ë°°ì¹˜ */
  .panel-inner {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0 12px;
  }
  .hint-box-wrap {
    grid-column: 1 / -1; /* íŒíŠ¸ë°•ìŠ¤ëŠ” ì „ì²´ ë„ˆë¹„ */
  }
  /* ë²„íŠ¼ ì˜ì—­ */
  .puzzle-info-panel {
    flex-wrap: wrap;
    gap: 8px;
  }
  .refresh-btn {
    font-size: 12px;
    padding: 7px 12px;
  }
  /* ìƒë‹¨ ì •ë‹µ/ì¸ì‡„ ë²„íŠ¼ */
  .top-btn-bar {
    padding: 0 10px;
  }
  footer { padding: 0 12px; }
}

/* 4. í¼ì¦ ë‚´ë¶€ ìš”ì†Œ */
canvas {
  background: #fff;
  border: 2px solid #333;
  display: block;
}
.guide {
  font-size: 13px;
  color: #666;
  margin-bottom: 8px;
}
.puzzle-info-panel {
  background: #fff;
  border: 1px solid #ddd;
  padding: 12px;
  margin: 10px 0;
  border-radius: 8px;
}

/* 5. íŒíŠ¸ ë¦¬ìŠ¤íŠ¸ ë””ìì¸ */
.panel h3 {
  margin: 20px 0 10px 0;
  font-size: 16px;
  border-bottom: 2px solid #0073e6;
  padding-bottom: 5px;
  color: #333;
}
.panel h3:first-child { margin-top: 0; }
.question { 
  margin-bottom: 10px; 
  font-size: 14px; 
  line-height: 1.5;
  cursor: pointer;
  padding: 4px;
  border-radius: 4px;
}
.question:hover { background: #f0f6ff; }
.hint-box {
  background: #f0f6ff;
  border-left: 4px solid #0073e6;
  padding: 12px;
  margin-bottom: 20px;
  font-size: 14px;
  font-weight: 500;
  border-radius: 0 4px 4px 0;
}

/* 6. ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.refresh-btn {
  padding: 8px 16px;
  background: #0073e6;
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
  font-size: 13px;
}
.refresh-btn:hover { background: #005bb7; }
.level-btn {
  padding: 6px 14px;
  border: 1px solid #ddd;
  background: #fff;
  border-radius: 4px;
  cursor: pointer;
  font-size: 13px;
}
.level-btn.active {
  background: #0073e6 !important;
  color: #fff !important;
  border-color: #0073e6 !important;
}

/* ì…€ ìœ„ì— ëœ¨ëŠ” í•œê¸€ ì…ë ¥ì°½ - opacity:0 ì´ì§€ë§Œ ì‹¤ì œ DOM ìœ„ì¹˜ì— ì¡´ì¬ */
#cellInput {
  position: absolute;
  opacity: 0;
  border: none;
  outline: none;
  padding: 0;
  margin: 0;
  font-size: 16px; /* iOS ìë™ ì¤Œ ë°©ì§€ */
  background: transparent;
  color: transparent;
  caret-color: transparent;
  z-index: 10;
  pointer-events: none;
}
.game-area { position: relative; }

footer {
  max-width: 1100px;
  margin: 60px auto 40px auto;
  padding: 0 20px;
  text-align: center;
}
.footer-divider {
  height: 1px;
  background: linear-gradient(to right, transparent, #ccc, transparent);
  margin-bottom: 30px;
}
.footer-branding { font-size: 14px; color: #888; margin-bottom: 10px; }
.footer-copyright { font-size: 12px; color: #aaa; }

/* AEO: ì„œë¹„ìŠ¤ ì •ì˜ ë¸”ë¡ (AI ì¸ìš© ìœ ë„) */
.service-definition {
  max-width: 1100px;
  margin: 0 auto 20px auto;
  padding: 16px 20px;
  background: #f0f6ff;
  border-left: 4px solid #0073e6;
  border-radius: 0 8px 8px 0;
  font-size: 14px;
  line-height: 1.7;
  color: #333;
}
.service-definition p { margin: 4px 0; }
/* AEO: í¼ì¦ í•˜ë‹¨ ìš”ì•½ (AIê°€ ì¸ìš©í•  ìˆ˜ ìˆëŠ” ë¸”ë¡) */
.puzzle-summary {
  margin: 32px 0 0 0;
  padding: 24px;
  background: #f8f9fa;
  border-left: 4px solid #0073e6;
  border-radius: 4px;
  max-width: 1100px;
  margin-left: auto;
  margin-right: auto;
  padding-left: 20px;
  padding-right: 20px;
}
.puzzle-summary h2 { font-size: 18px; margin: 0 0 12px 0; color: #111; }
.ai-friendly-summary { font-size: 16px; line-height: 1.8; color: #333; margin: 0; }

/* ê¸°ë³¸ í™”ë©´ì—ì„œëŠ” ìˆ¨ê¹€ */
.print-only { display: none !important; }
#print-wrapper { display: none !important; }

/* ì¸ì‡„ ì˜ì—­ ë‚´ë¶€ ìŠ¤íƒ€ì¼ (ë¯¸ë¦¬ë³´ê¸°/ì¸ì‡„ ì‹œ ê³µí†µ) */
#print-wrapper .print-logo-wrap { text-align: center; margin-bottom: 12px; }
#print-wrapper .print-logo { max-width: 180px; height: auto; display: inline-block; }
#print-wrapper .print-top-section { display: flex; gap: 14px; align-items: flex-start; margin-bottom: 14px; }
#print-wrapper .print-right-panel { flex: 1; min-width: 0; display: flex; flex-direction: column; gap: 10px; }
#print-wrapper .print-info-block { display: flex; flex-direction: column; gap: 6px; padding: 10px 12px; background: #f8f9fa; border: 1px solid #ddd; border-radius: 4px; }
#print-wrapper .print-info-row { display: flex; align-items: baseline; gap: 8px; line-height: 1.5; }
#print-wrapper .print-label { font-size: 11px; color: #666; font-weight: 600; min-width: 48px; flex-shrink: 0; }
#print-wrapper #target-church-name { font-size: 16px; font-weight: bold; color: #111; }
#print-wrapper #target-top-memo { font-size: 13px; color: #333; flex: 1; word-break: keep-all; line-height: 1.5; }
#print-wrapper .print-qr-box { display: flex; align-items: center; gap: 10px; padding: 8px 12px; border: 1px solid #999; border-radius: 4px; background: #f8f9fa; }
#print-wrapper .print-qr-label { flex: 1; font-size: 10px; color: #444; line-height: 1.5; }
#print-wrapper .print-qr-label strong { display: block; margin-bottom: 4px; font-size: 11px; color: #222; }
#print-wrapper #print-clue-section { margin-top: 0; }
#print-wrapper #print-clue-columns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
#print-wrapper .print-page-break { page-break-before: always; margin-top: 0; padding-top: 0; }
#print-wrapper .print-answer-label { text-align: center; font-size: 18px; font-weight: bold; color: #0073e6; margin-bottom: 12px; }

@media print {
  /* â”€â”€ ìˆ¨ê¸¸ ìš”ì†Œ â”€â”€ */
  .nav, header, main, footer, .guide, .puzzle-info-panel,
  button, .no-print, #popupAnswer, #popupAuth, #adPopup, #premium-badge {
    display: none !important;
  }

  /* â”€â”€ ì¸ì‡„ ì˜ì—­ í‘œì‹œ â”€â”€ */
  .print-only { display: block !important; }
  #print-wrapper { display: block !important; }

  /* â”€â”€ í˜ì´ì§€ ì„¤ì • â”€â”€ */
  @page { size: A4 portrait; margin: 12mm 10mm; }

  body {
    background: white !important;
    margin: 0 !important; padding: 0 !important;
    font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif !important;
  }
  * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }

  /* â”€â”€ wrapper â”€â”€ */
  #print-wrapper {
    width: 190mm !important;
    margin: 0 auto !important;
    box-sizing: border-box !important;
  }

  /* â”€â”€ 1. ë¡œê³  â”€â”€ */
  .print-logo-wrap {
    text-align: center !important;
    margin-bottom: 12px !important;
  }
  .print-logo {
    max-width: 160px !important;
    height: auto !important;
    display: inline-block !important;
  }

  /* â”€â”€ 2. í¼ì¦ + ìš°ì¸¡(êµíšŒ/ë©”ëª¨/ì •ë‹µí™•ì¸) â”€â”€ */
  #print-top-section {
    display: flex !important;
    flex-direction: row !important;
    gap: 14px !important;
    align-items: flex-start !important;
    margin-bottom: 14px !important;
  }
  #print-canvas-wrap { flex: 0 0 auto !important; }
  #print-canvas {
    width: 108mm !important;
    height: 108mm !important;
    border: 2px solid #222 !important;
    display: block !important;
    image-rendering: pixelated !important;
  }
  .print-right-panel {
    flex: 1 !important;
    min-width: 0 !important;
    display: flex !important;
    flex-direction: column !important;
    gap: 10px !important;
  }
  .print-info-block {
    padding: 10px 12px !important;
    background: #f8f9fa !important;
    border: 1px solid #ddd !important;
    border-radius: 4px !important;
  }
  #target-church-name { font-size: 16px !important; font-weight: bold !important; color: #111 !important; }
  #target-top-memo { font-size: 13px !important; color: #333 !important; }
  #print-qr-box {
    display: flex !important;
    align-items: center !important;
    gap: 10px !important;
    padding: 8px 12px !important;
    border: 1px solid #999 !important;
    border-radius: 4px !important;
    background: #f8f9fa !important;
  }
  #print-qr-label { font-size: 10px !important; color: #444 !important; line-height: 1.5 !important; }
  #print-qr-label strong { font-size: 11px !important; color: #222 !important; display: block !important; margin-bottom: 4px !important; }
  #qr-img {
    width: 64px !important;
    height: 64px !important;
    flex: 0 0 64px !important;
    border: 1px solid #ccc !important;
    display: block !important;
  }

  /* â”€â”€ 3. ê°€ë¡œ/ì„¸ë¡œ íŒíŠ¸ (1+2 ì˜ì—­ ì•„ë˜, ë‚¨ì€ ê³µê°„ ë°°ì¹˜) â”€â”€ */
  #print-clue-section {
    margin-top: 0 !important;
    break-inside: avoid !important;
  }
  #print-clue-columns {
    display: grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 10px !important;
  }
  #print-across-box,
  #print-down-box {
    border: 1px solid #999 !important;
    border-radius: 4px !important;
    padding: 8px 10px !important;
    background: #fff !important;
    break-inside: avoid !important;
  }
  #print-across-box h3,
  #print-down-box h3 {
    font-size: 11px !important;
    color: #222 !important;
    font-weight: bold !important;
    margin: 0 0 5px 0 !important;
    padding-bottom: 3px !important;
    border-bottom: 2px solid #333 !important;
  }
  #print-across-list .question,
  #print-down-list .question {
    display: block !important;
    font-size: 10px !important;
    line-height: 1.6 !important;
    padding: 2px 6px !important;
    margin-bottom: 2px !important;
    border-left: 3px solid #333 !important;
    border-radius: 0 2px 2px 0 !important;
    background: white !important;
    word-break: keep-all !important;
    break-inside: avoid !important;
    color: #222 !important;
  }
  #print-across-list .question:nth-child(odd),
  #print-down-list .question:nth-child(odd) {
    background: #fafafa !important;
  }

  /* â”€â”€ 2í˜ì´ì§€: ì •ë‹µ â”€â”€ */
  .print-page-break {
    page-break-before: always !important;
  }
  .print-answer-label {
    font-size: 18px !important;
    font-weight: bold !important;
    color: #0073e6 !important;
    text-align: center !important;
    margin-bottom: 12px !important;
  }
  #print-canvas-wrap-2 { flex: 0 0 auto !important; }
  #print-canvas-answer {
    width: 108mm !important;
    height: 108mm !important;
    border: 2px solid #222 !important;
    display: block !important;
    image-rendering: pixelated !important;
  }
  #print-across-list-2 .question,
  #print-down-list-2 .question {
    display: block !important;
    font-size: 10px !important;
    line-height: 1.6 !important;
    padding: 2px 6px !important;
    margin-bottom: 2px !important;
    border-left: 3px solid #333 !important;
    border-radius: 0 2px 2px 0 !important;
    background: white !important;
    word-break: keep-all !important;
    break-inside: avoid !important;
    color: #222 !important;
  }
}

/* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
.toast-message {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(0, 0, 0, 0.85);
  color: white;
  padding: 20px 30px;
  border-radius: 12px;
  font-size: 16px;
  font-weight: bold;
  z-index: 10000;
  animation: fadeInOut 2s ease-in-out;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

@keyframes fadeInOut {
  0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
  15% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
  85% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
  100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
}

</style>

</head>

<body>
  

<nav class="nav">
  <a href="index.html" class="nav-item">í™ˆ</a>
  <a href="play.html" class="nav-item nav-active">í¼ì¦í•˜ê¸°</a>
  <a href="list.html" class="nav-item">í¼ì¦ëª©ë¡</a>
  <a href="posts/index.html" class="nav-item">ê²Œì‹œíŒ</a>
  <a href="about.html" class="nav-item">ì†Œê°œ</a>
  <a href="support.html" class="nav-item">í›„ì›</a>
</nav>

<header>
  <a href="index.html" style="text-decoration: none; display: inline-block;">
    <img src="images/crossero-logo.png" alt="ì‹­ìê°€ë¡œì„¸ë¡œ">
  </a>
  <p id="dynamicTitle">ë§ì”€ ê°€ë¡œì„¸ë¡œ í¼ì¦</p>
</header>

<!-- ì¸ì‡„ ì „ìš© ì˜ì—­ -->
<div id="print-wrapper" class="print-only" style="display:none;">

  <!-- 1. ë¡œê³  -->
  <div class="print-logo-wrap">
    <img src="images/crossero-logo.png" alt="ì‹­ìê°€ë¡œì„¸ë¡œ" class="print-logo">
  </div>

  <!-- 2. í¼ì¦ + ìš°ì¸¡(êµíšŒ/ë©”ëª¨/ì •ë‹µí™•ì¸) -->
  <div id="print-top-section" class="print-top-section">
    <div id="print-canvas-wrap">
      <canvas id="print-canvas" width="900" height="900"></canvas>
    </div>
    <div class="print-right-panel">
      <div class="print-info-block">
        <div class="print-info-row">
          <span class="print-label">êµíšŒëª…</span>
          <span id="target-church-name" class="print-church">êµíšŒëª…</span>
        </div>
        <div class="print-info-row">
          <span class="print-label">ë©”ëª¨</span>
          <span id="target-top-memo" class="print-memo">ë©”ëª¨</span>
        </div>
      </div>
      <div id="print-qr-box" class="print-qr-box">
        <div id="print-qr-label" class="print-qr-label">
          <strong>ë” ë§ì€ í¼ì¦ì´ ê¶ê¸ˆí•˜ë‹¤ë©´?</strong>
          crossero.comì—ì„œ í™•ì¸í•˜ì„¸ìš”.
        </div>
        <img id="qr-img" src="" alt="crossero.com" width="64" height="64">
      </div>
    </div>
  </div>

  <!-- 3. ê°€ë¡œ/ì„¸ë¡œ íŒíŠ¸ (1+2 ì˜ì—­ ì•„ë˜) -->
  <div id="print-clue-section" class="print-clue-section">
    <div id="print-clue-columns">
      <div id="print-across-box">
        <h3>ê°€ë¡œ</h3>
        <div id="print-across-list"></div>
      </div>
      <div id="print-down-box">
        <h3>ì„¸ë¡œ</h3>
        <div id="print-down-list"></div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ 2í˜ì´ì§€: ì •ë‹µ (1í˜ì´ì§€ì™€ ë™ì¼í•œ í¼) â”€â”€ -->
  <div id="print-page-2" class="print-page-break">
    <div class="print-answer-label">âœ½ ì •ë‹µ âœ½</div>
    <div class="print-logo-wrap">
      <img src="images/crossero-logo.png" alt="ì‹­ìê°€ë¡œì„¸ë¡œ" class="print-logo">
    </div>
    <div id="print-top-section-2" class="print-top-section">
      <div id="print-canvas-wrap-2" class="print-canvas-wrap">
        <canvas id="print-canvas-answer" width="900" height="900"></canvas>
      </div>
      <div class="print-right-panel">
        <div class="print-info-block">
          <div class="print-info-row">
            <span class="print-label">êµíšŒëª…</span>
            <span id="target-church-name-2" class="print-church">êµíšŒëª…</span>
          </div>
          <div class="print-info-row">
            <span class="print-label">ë©”ëª¨</span>
            <span id="target-top-memo-2" class="print-memo">ë©”ëª¨</span>
          </div>
        </div>
        <div id="print-qr-box-2" class="print-qr-box">
          <div class="print-qr-label">
            <strong>ë” ë§ì€ í¼ì¦ì´ ê¶ê¸ˆí•˜ë‹¤ë©´?</strong>
            crossero.comì—ì„œ í™•ì¸í•˜ì„¸ìš”.
          </div>
          <img id="qr-img-2" src="" alt="crossero.com" width="64" height="64">
        </div>
      </div>
    </div>
    <div id="print-clue-section-2" class="print-clue-section">
      <div id="print-clue-columns">
        <div id="print-across-box-2" class="print-across-box">
          <h3>ê°€ë¡œ</h3>
          <div id="print-across-list-2"></div>
        </div>
        <div id="print-down-box-2" class="print-down-box">
          <h3>ì„¸ë¡œ</h3>
          <div id="print-down-list-2"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<div style="max-width: 1100px; margin: 10px auto; padding: 0 20px; display: flex; gap: 10px; justify-content: flex-end;">
  <button id="btnAnswer" onclick="handlePremiumFeature('answer')" style="padding: 10px 18px; background: #fff; border: 1.5px solid #0073e6; color: #0073e6; border-radius: 8px; font-weight: bold; cursor: pointer;">ğŸ” ì •ë‹µë³´ê¸°</button>
  <button onclick="handlePremiumFeature('print')" style="padding: 10px 18px; background: #0073e6; color: #fff; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°</button>
</div>

<main>
  <div class="service-definition" id="serviceDefinition">
    <p><strong>ì‹­ìê°€ë¡œì„¸ë¡œ</strong>ëŠ” ì„±ê²½ ê¸°ë°˜ ê°€ë¡œì„¸ë¡œ í¼ì¦ ì˜¨ë¼ì¸ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.</p>
    <p>êµíšŒ ì£¼ë³´ì™€ ì£¼ì¼í•™êµì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¬´ë£Œ êµìœ¡ ìë£Œë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>
    <p>ì„±ê²½ ì¸ë¬¼, ì‚¬ê±´, í•µì‹¬ êµ¬ì ˆì„ ë°”íƒ•ìœ¼ë¡œ ì œì‘ëœ êµìœ¡í˜• í¼ì¦ í”Œë«í¼ì…ë‹ˆë‹¤.</p>
  </div>
  <div class="game-area">
    <!-- ì…€ ìœ„ í•œê¸€ ì…ë ¥ì°½: ìº”ë²„ìŠ¤ì™€ ê°™ì€ ë¶€ëª¨ì— absolute ë°°ì¹˜ -->
    <input id="cellInput" type="text" autocomplete="off" autocorrect="off"
           autocapitalize="off" spellcheck="false" inputmode="text">
    <div class="guide">âœï¸ í¼ì¦ ìƒì„± ê°€ì´ë“œ</div>
    
    <div class="puzzle-info-panel" style="display:flex; justify-content:space-between; align-items:center;">
      <div style="display:flex; gap:10px;">
        <button onclick="setupQuiz(3)" class="refresh-btn">ğŸ”„ ë‚±ë§ ìƒˆë¡œ ìƒì„±</button>
      </div>
      <div style="font-size:13px; color:#444; text-align:right;">
        ë¬¸í•­: <span id="qCountText">0</span>ê°œ | 
        ì†Œìš”ì˜ˆìƒ: <span id="qTimeText">0ë¶„</span>
      </div>
    </div>

    <div class="guide" style="display:flex; flex-direction:column; gap:4px; margin-bottom:8px;">
      <span>âœï¸ í•œ ê¸€ìì”© ì…ë ¥ Â· ë°©í–¥í‚¤ ì´ë™ Â· Backspace ìˆ˜ì •</span>
      <span id="actualDisplay" style="color:#0073e6; font-weight:bold;"></span>
    </div>

    <canvas id="puzzle" width="450" height="450"></canvas>
  </div>


  
  <div class="panel-container">
    <div class="panel">
      <div class="hint-box-wrap">
        <div class="hint-box" id="hintBox">ğŸ‘‰ ì¹¸ì„ ì„ íƒí•˜ë©´ íŒíŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤</div>
      </div>
      <div class="panel-inner">
        <div class="panel-across">
          <h3>ê°€ë¡œ</h3>
          <div id="acrossList"></div>
        </div>
        <div class="panel-down">
          <h3>ì„¸ë¡œ</h3>
          <div id="downList"></div>
        </div>
      </div>
    </div>
  </div>
  <section id="puzzle-summary" class="puzzle-summary" style="display: none;" aria-label="ì´ í¼ì¦ ì£¼ì œ ì†Œê°œ">
    <h2 id="puzzle-summary-title"></h2>
    <p class="ai-friendly-summary" id="puzzle-summary-text"></p>
  </section>
</main>

<footer>
  <div class="footer-divider"></div>
  
  <div style="display: flex; gap: 12px; justify-content: center; margin-bottom: 30px;">
      <a href="about.html" style="flex: 1; max-width: 180px; text-align: center; padding: 10px; background: #fff; border: 1px solid #ddd; color: #555; text-decoration: none; border-radius: 8px; font-size: 13px;">ğŸ“– ë§Œë“  ì´ìœ </a>
      <a href="support.html" style="flex: 1; max-width: 180px; text-align: center; padding: 10px; background: #fff; border: 1px solid #0073e6; color: #0073e6; text-decoration: none; border-radius: 8px; font-size: 13px; font-weight: bold;">ğŸ™ í›„ì› ì‘ì›</a>
  </div>

  <div class="footer-branding">
    Crossero Puzzle <strong>Engine by PuzDuk.com</strong>
  </div>
  
  <div class="footer-copyright">
    Â© 2026 ì‹­ìê°€ë¡œì„¸ë¡œ. All rights reserved.
  </div>
</footer>





<script>
/* =====================
   1. ë°ì´í„° ë° ì´ˆê¸° ì„¤ì •
===================== */
const urlParams = new URLSearchParams(window.location.search);
const quizId = urlParams.get('id') || "genesis_01";

// [ì¶”ê°€] í†µí•© ë°ì´í„° í’€ ê´€ë¦¬ ë³€ìˆ˜
let currentWordsPool = [];

let QUIZ = { across: [], down: [] };
const SIZE = 15;  
const CELL = 30;  
const canvas = document.getElementById("puzzle");
const ctx = canvas.getContext("2d");
const input = document.getElementById("cellInput");
const hintBox = document.getElementById("hintBox");
const acrossList = document.getElementById("acrossList");
const downList = document.getElementById("downList");

let solution = [...Array(SIZE)].map(()=>Array(SIZE).fill(null)); 
let grid = [...Array(SIZE)].map(()=>Array(SIZE).fill(""));       
let numberMap = [...Array(SIZE)].map(()=>Array(SIZE).fill(null)); 
let cursor = {x:null,y:null}; 
let composing = false;      
let composingChar = "";     

function showToast(html, duration = 2000) {
  const el = document.createElement("div");
  el.className = "toast-message";
  el.innerHTML = html;
  document.body.appendChild(el);
  setTimeout(() => el.remove(), duration);
}

// í¼ì¦ ì •ë‹µ URL ì¸ì½”ë”© (QRìš©, ê°„ê²°í•œ í˜•ì‹ìœ¼ë¡œ URL ê¸¸ì´ ì ˆì•½)
function encodePuzzleAnswerUrl() {
  let sStr = '';
  for (let y = 0; y < SIZE; y++) {
    for (let x = 0; x < SIZE; x++) {
      const c = solution[y][x];
      sStr += c === null ? '.' : c;
    }
  }
  const nParts = [];
  for (let y = 0; y < SIZE; y++) {
    for (let x = 0; x < SIZE; x++) {
      if (numberMap[y][x] != null) nParts.push(numberMap[y][x] + ',' + y + ',' + x);
    }
  }
  const str = sStr + '|' + nParts.join(';');
  const b64 = btoa(unescape(encodeURIComponent(str)));
  const base = window.location.origin + window.location.pathname;
  return base + '?answer=1&g=' + encodeURIComponent(b64);
}

// í¼ì¦ ì •ë‹µ URL ë””ì½”ë”© ë° ë³µì›
function decodeAndRestorePuzzleAnswer(encoded) {
  try {
    const b64 = decodeURIComponent(encoded);
    const str = decodeURIComponent(escape(atob(b64)));
    const [sStr, nStr] = str.split('|');
    if (!sStr || sStr.length !== SIZE * SIZE) return false;
    for (let y = 0; y < SIZE; y++) {
      for (let x = 0; x < SIZE; x++) {
        const i = y * SIZE + x;
        const c = sStr[i];
        solution[y][x] = c === '.' ? null : c;
        grid[y][x] = solution[y][x] !== null ? solution[y][x] : "";
        numberMap[y][x] = null;
      }
    }
    if (nStr) {
      nStr.split(';').filter(Boolean).forEach(part => {
        const arr = part.split(',').map(Number);
        if (arr.length >= 3) {
          const [num, y, x] = arr;
          if (y >= 0 && y < SIZE && x >= 0 && x < SIZE) numberMap[y][x] = num;
        }
      });
    }
    return true;
  } catch (e) {
    console.warn('í¼ì¦ ì •ë‹µ ë””ì½”ë”© ì‹¤íŒ¨:', e);
    return false;
  }
}

/* =====================
   ìƒˆë¡œ ì¶”ê°€ëœ ë°ì´í„° ë¡œë“œ ë° ë²ˆì—­ í•¨ìˆ˜
===================== */
function loadAndTranslateData() {
  const savedData = localStorage.getItem('gameData');
  
  if (savedData) {
    const rawList = JSON.parse(savedData);
    
    // [ì¶”ê°€] í•„í„°ë§ëœ ë°ì´í„°ì¸ ê²½ìš° ì œëª©ì„ ë™ì ìœ¼ë¡œ ë³€ê²½
    if (document.getElementById('dynamicTitle')) {
      document.getElementById('dynamicTitle').innerText = "ì‚¬ìš©ì ì„ íƒ ë‹¨ì–´ í¼ì¦";
    }
    currentWordsPool = rawList.map(item => {
      // data.jsì˜ ì „ì²´ DBë¥¼ ë’¤ì ¸ì„œ íƒœê·¸ì™€ ì„¤ëª…ì„ ì°¾ìŒ (ìë™ ë²ˆì—­)
      let sourceInfo = null;
      for (const key in QUIZ_DATABASE) {
        const found = QUIZ_DATABASE[key].allWords.find(w => w.answer === item.answer);
        if (found) { sourceInfo = found; break; }
      }
      return {
        answer: item.answer || item.name,
        clue: item.clue || (sourceInfo ? sourceInfo.clue : "ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤."),
        tag: sourceInfo ? sourceInfo.tag : "ë¯¸ë¶„ë¥˜",
        category: sourceInfo ? sourceInfo.category : "ê¸°ë³¸"
      };
    });
  } else {
    // â­ URL íŒŒë¼ë¯¸í„° í™•ì¸
    const urlParams = new URLSearchParams(window.location.search);
    const quizId = urlParams.get('id');
    const category = urlParams.get('category'); // â­ ìƒˆë¡œìš´ íŒŒë¼ë¯¸í„°
    
    console.log('Loading quiz data - quizId:', quizId, 'category:', category);
    
    // â­ 1ìˆœìœ„: ì¹´í…Œê³ ë¦¬ë¡œ í†µí•© ë¡œë“œ
    if (category) {
      currentWordsPool = getCombinedWordsByCategory(category);
      console.log(`âœ… ì¹´í…Œê³ ë¦¬ "${category}" í†µí•© ë¡œë“œ: ${currentWordsPool.length}ê°œ`);
    }
    // â­ 2ìˆœìœ„: ê°œë³„ í€´ì¦ˆ ë¡œë“œ
    else if (quizId && QUIZ_DATABASE[quizId]) {
      // quizId ì ‘ë‘ì–´ë¡œ ê°™ì€ ê·¸ë£¹ ì°¾ê¸° (ì˜ˆ: gen_001 â†’ gen_ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  í€´ì¦ˆ)
      const prefix = quizId.split('_')[0]; // "gen", "exo", "lev" ë“±
      const combinedWords = getCombinedWordsByPrefix(prefix);
      
      if (combinedWords.length > QUIZ_DATABASE[quizId].allWords.length) {
        // ê°™ì€ ê·¸ë£¹ì˜ ë‹¤ë¥¸ í€´ì¦ˆê°€ ìˆìœ¼ë©´ í†µí•©
        currentWordsPool = combinedWords;
        console.log(`âœ… "${prefix}" ê·¸ë£¹ í†µí•© ë¡œë“œ: ${currentWordsPool.length}ê°œ`);
      } else {
        // ë‹¨ë… í€´ì¦ˆ
        currentWordsPool = QUIZ_DATABASE[quizId].allWords;
        console.log(`âœ… ê°œë³„ í€´ì¦ˆ ë¡œë“œ: ${currentWordsPool.length}ê°œ`);
      }
    }
    // â­ 3ìˆœìœ„: íŒŒë¼ë¯¸í„° ì—†ì´ ì§ì ‘ ì ‘ê·¼ (ë©”ë‰´ > í¼ì¦í•˜ê¸°)
    else {
      // ì„±ê²½ì¼ë°˜ ì „ì²´ í†µí•© ë¡œë“œ (ê°€ì¥ ë§ì€ ë‹¨ì–´)
      currentWordsPool = getCombinedWordsByCategory('ì„±ê²½ì¼ë°˜');
      if (currentWordsPool.length === 0) {
        // ì„±ê²½ì¼ë°˜ì´ ì—†ìœ¼ë©´ êµ¬ì•½+ì‹ ì•½ ì „ì²´
        currentWordsPool = [
          ...getCombinedWordsByCategory('êµ¬ì•½ì„±ê²½'),
          ...getCombinedWordsByCategory('ì‹ ì•½ì„±ê²½')
        ];
      }
      console.log(`âœ… ê¸°ë³¸ ì „ì²´ ë¡œë“œ: ${currentWordsPool.length}ê°œ`);
    }
  }
}

// â­ ìƒˆë¡œìš´ í•¨ìˆ˜: ì ‘ë‘ì–´ë¡œ ë‹¨ì–´ í†µí•©
function getCombinedWordsByPrefix(prefix) {
  const combined = [];
  const usedKeys = new Set(); // ì¤‘ë³µ ë°©ì§€
  
  for (const key in QUIZ_DATABASE) {
    if (key.startsWith(prefix + '_')) {
      const quizData = QUIZ_DATABASE[key];
      quizData.allWords.forEach(word => {
        const uniqueKey = word.answer + '::' + word.clue;
        if (!usedKeys.has(uniqueKey)) {
          combined.push(word);
          usedKeys.add(uniqueKey);
        }
      });
    }
  }
  
  return combined;
}

// â­ ìƒˆë¡œìš´ í•¨ìˆ˜: ì¹´í…Œê³ ë¦¬ë¡œ ë‹¨ì–´ í†µí•©
function getCombinedWordsByCategory(categoryKeyword) {
  const combined = [];
  const usedKeys = new Set(); // ì¤‘ë³µ ë°©ì§€
  
  for (const key in QUIZ_DATABASE) {
    const quizData = QUIZ_DATABASE[key];
    
    // category ë¬¸ìì—´ì— í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
    if (quizData.category && quizData.category.includes(categoryKeyword)) {
      quizData.allWords.forEach(word => {
        const uniqueKey = word.answer + '::' + word.clue;
        if (!usedKeys.has(uniqueKey)) {
          combined.push(word);
          usedKeys.add(uniqueKey);
        }
      });
    }
  }
  
  return combined;
}

/* =====================
   2. í¼ì¦ ì´ˆê¸°í™” (setupQuiz)
===================== */
function setupQuiz(level) {
  // config ì„¤ì •ê°’ ë¡œë“œ
  const dbEntry = QUIZ_DATABASE[quizId] || QUIZ_DATABASE["gen_001"];
  const cfg = dbEntry.config ? dbEntry.config[3] : { time: "20ë¶„" };

  // â­ ë‹¨ì–´ í’€ì´ ë¹„ì–´ìˆìœ¼ë©´ ë¨¼ì € ë‹¤ì‹œ ë¡œë“œ (ë²„íŠ¼ ì¬ìƒì„± ì‹œ ëŒ€ë¹„)
  if (!currentWordsPool || currentWordsPool.length === 0) {
    loadAndTranslateData();
  }

  // â­ ë‹¨ì–´ í’€ í¬ê¸°ì— ë”°ë¼ ëª©í‘œ ê°œìˆ˜ ìë™ ì¡°ì •
  const poolSize = currentWordsPool.length;
  let targetCount;
  
  if (poolSize >= 50) {
    targetCount = 35;
  } else if (poolSize >= 30) {
    targetCount = 20;
  } else if (poolSize >= 15) {
    targetCount = 12;
  } else if (poolSize >= 8) {
    targetCount = 8;
  } else {
    targetCount = Math.max(5, poolSize - 2);
  }
  
  console.log(`ğŸ“Š ë‹¨ì–´ í’€: ${poolSize}ê°œ â†’ ëª©í‘œ: ${targetCount}ê°œ`);

  if(document.getElementById('qCountText')) document.getElementById('qCountText').innerText = targetCount;
  if(document.getElementById('qTimeText')) document.getElementById('qTimeText').innerText = cfg.time;
  
  QUIZ = { across: [], down: [] }; 
  grid = [...Array(SIZE)].map(()=>Array(SIZE).fill("")); 
  solution = [...Array(SIZE)].map(()=>Array(SIZE).fill(null)); 
  numberMap = [...Array(SIZE)].map(()=>Array(SIZE).fill(null));
  cursor = {x:null, y:null};
  acrossList.innerHTML = ""; 
  downList.innerHTML = "";
  hintBox.innerHTML = "ğŸ‘‰ ì¹¸ì„ ì„ íƒí•˜ë©´ íŒíŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤";

  // ë²ˆì—­ëœ ë°ì´í„° í’€ì—ì„œ ëœë¤í•˜ê²Œ ì„ìŒ
  const shuffled = [...currentWordsPool].sort(() => 0.5 - Math.random());
  
  buildSolution(shuffled, targetCount); // â­ cfg.qCount â†’ targetCount ë¡œ ìˆ˜ì •!
  renderClues(); 
  draw();        

  const actualPlacedCount = QUIZ.across.length + QUIZ.down.length;
  if(document.getElementById('actualDisplay')) {
    document.getElementById('actualDisplay').innerText = `âœ… ë°°ì¹˜ ì„±ê³µ: ${actualPlacedCount}ê°œ`;
  }
}

/* =====================
   3. ìë™ êµì°¨ ë°°ì¹˜ ì•Œê³ ë¦¬ì¦˜ - êµì°¨ìœ¨ ê°•í™”
===================== */
function buildSolution(pool, targetCount) {
  let num = 1;
  const placedWords = [];
  const usedAnswers = new Set();

  // â­ ë¹ˆ ê³µê°„ ì°¾ê¸° í•¨ìˆ˜ (ì™„ì „íˆ ì¬ì‘ì„±)
  function findEmptySpace(wordLength, direction) {
    const attempts = 300;
    
    for (let attempt = 0; attempt < attempts; attempt++) {
      let rx, ry;
      
      // ëœë¤ ìœ„ì¹˜ ì„ íƒ
      if (direction === 'across') {
        rx = Math.floor(Math.random() * Math.max(1, SIZE - wordLength));
        ry = Math.floor(Math.random() * SIZE);
      } else {
        rx = Math.floor(Math.random() * SIZE);
        ry = Math.floor(Math.random() * Math.max(1, SIZE - wordLength));
      }
      
      // ë‹¨ì–´ê°€ ë“¤ì–´ê°ˆ ê³µê°„ì´ ì™„ì „íˆ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
      let isEmpty = true;
      
      // 1. ë‹¨ì–´ ìì²´ê°€ ë“¤ì–´ê°ˆ ì¹¸ ì²´í¬
      for (let k = 0; k < wordLength; k++) {
        const cx = direction === 'across' ? rx + k : rx;
        const cy = direction === 'across' ? ry : ry + k;
        
        if (solution[cy][cx] !== null) {
          isEmpty = false;
          break;
        }
      }
      
      if (!isEmpty) continue;
      
      // 2. ì•ë’¤ 1ì¹¸ì”© ë¹„ì–´ìˆëŠ”ì§€ ì²´í¬ (ë‹¨ì–´ê°€ ë¶™ì§€ ì•Šë„ë¡)
      const beforeX = direction === 'across' ? rx - 1 : rx;
      const beforeY = direction === 'across' ? ry : ry - 1;
      const afterX = direction === 'across' ? rx + wordLength : rx;
      const afterY = direction === 'across' ? ry : ry + wordLength;
      
      if (beforeX >= 0 && beforeY >= 0 && beforeX < SIZE && beforeY < SIZE) {
        if (solution[beforeY][beforeX] !== null) {
          isEmpty = false;
          continue;
        }
      }
      
      if (afterX >= 0 && afterY >= 0 && afterX < SIZE && afterY < SIZE) {
        if (solution[afterY][afterX] !== null) {
          isEmpty = false;
          continue;
        }
      }
      
      // 3. ì–‘ ì˜†(ê°€ë¡œë©´ ìœ„ì•„ë˜, ì„¸ë¡œë©´ ì¢Œìš°) 1ì¹¸ì”© ë¹„ì–´ìˆëŠ”ì§€ ì²´í¬
      for (let k = 0; k < wordLength; k++) {
        const cx = direction === 'across' ? rx + k : rx;
        const cy = direction === 'across' ? ry : ry + k;
        
        if (direction === 'across') {
          // ê°€ë¡œë©´ ìœ„ì•„ë˜ ì²´í¬
          if (cy - 1 >= 0 && solution[cy - 1][cx] !== null) {
            isEmpty = false;
            break;
          }
          if (cy + 1 < SIZE && solution[cy + 1][cx] !== null) {
            isEmpty = false;
            break;
          }
        } else {
          // ì„¸ë¡œë©´ ì¢Œìš° ì²´í¬
          if (cx - 1 >= 0 && solution[cy][cx - 1] !== null) {
            isEmpty = false;
            break;
          }
          if (cx + 1 < SIZE && solution[cy][cx + 1] !== null) {
            isEmpty = false;
            break;
          }
        }
      }
      
      if (isEmpty) {
        return { x: rx, y: ry };
      }
    }
    
    return null;
  }

  // ì²« ë‹¨ì–´ ë°°ì¹˜ (ì¤‘ì•™ì—)
  const first = pool.shift();
  if (!first) return;
  
  first.dir = 'across';
  first.x = Math.floor((SIZE - first.answer.length) / 2);
  first.y = Math.floor(SIZE / 2);
  
  [...first.answer].forEach((c, i) => { 
    solution[first.y][first.x + i] = c; 
  });
  
  numberMap[first.y][first.x] = num++;
  const firstData = {...first, num: numberMap[first.y][first.x]};
  QUIZ.across.push(firstData);
  placedWords.push(firstData);
  usedAnswers.add(first.answer + '::' + first.clue);

  // â­ ì „ì²´ ë‹¨ì–´ ëŒ€ìƒìœ¼ë¡œ êµì°¨ì  í›„ë³´ë¥¼ ëª¨ë‘ ìˆ˜ì§‘í•˜ëŠ” í•¨ìˆ˜
  function findAllOverlaps(newWord) {
    const candidates = [];
    // ë°°ì¹˜ëœ ëª¨ë“  ë‹¨ì–´ë¥¼ ëŒ€ìƒìœ¼ë¡œ êµì°¨ ì‹œë„ (ìµœê·¼ìˆœ ìš°ì„ )
    const targets = [...placedWords].reverse();
    for (const existingWord of targets) {
      const newDir = existingWord.dir === 'across' ? 'down' : 'across';
      for (let newIdx = 0; newIdx < newWord.answer.length; newIdx++) {
        for (let existIdx = 0; existIdx < existingWord.answer.length; existIdx++) {
          if (newWord.answer[newIdx] !== existingWord.answer[existIdx]) continue;
          
          let newX, newY;
          if (newDir === 'across') {
            newX = existingWord.x - newIdx;
            newY = existingWord.y + existIdx;
          } else {
            newX = existingWord.x + existIdx;
            newY = existingWord.y - newIdx;
          }
          
          // ë²”ìœ„ ì²´í¬
          if (newDir === 'across') {
            if (newX < 0 || newX + newWord.answer.length > SIZE) continue;
            if (newY < 0 || newY >= SIZE) continue;
          } else {
            if (newX < 0 || newX >= SIZE) continue;
            if (newY < 0 || newY + newWord.answer.length > SIZE) continue;
          }
          
          // ë°°ì¹˜ ê°€ëŠ¥ ì²´í¬
          let canPlace = true;
          for (let k = 0; k < newWord.answer.length; k++) {
            const checkX = newDir === 'across' ? newX + k : newX;
            const checkY = newDir === 'across' ? newY : newY + k;
            const existing = solution[checkY][checkX];
            
            if (existing !== null && existing !== newWord.answer[k]) {
              canPlace = false; break;
            }
            if (existing === null) {
              for (let {dx, dy} of [{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}]) {
                const nx = checkX + dx, ny = checkY + dy;
                if (nx < 0 || nx >= SIZE || ny < 0 || ny >= SIZE) continue;
                const isCross = (nx === existingWord.x + (existingWord.dir==='across' ? existIdx : 0)) &&
                                (ny === existingWord.y + (existingWord.dir==='down'   ? existIdx : 0));
                if (!isCross && solution[ny][nx] !== null) { canPlace = false; break; }
              }
            }
            if (!canPlace) break;
          }
          
          if (canPlace) {
            // â­ êµì°¨ ì ìˆ˜ ê³„ì‚° (ì´ë¯¸ ë°°ì¹˜ëœ ë‹¨ì–´ì™€ êµì°¨ ìˆ˜ê°€ ë§ì„ìˆ˜ë¡ ë†’ì€ ì ìˆ˜)
            let crossScore = 0;
            for (let k = 0; k < newWord.answer.length; k++) {
              const cx = newDir === 'across' ? newX + k : newX;
              const cy = newDir === 'across' ? newY : newY + k;
              if (solution[cy][cx] !== null) crossScore++;
            }
            candidates.push({ x: newX, y: newY, dir: newDir, score: crossScore });
          }
        }
      }
    }
    // â­ êµì°¨ ì ìˆ˜ ë†’ì€ ìˆœìœ¼ë¡œ ì •ë ¬ (ë” ë§ì´ ê²¹ì¹˜ëŠ” ìœ„ì¹˜ ìš°ì„ )
    candidates.sort((a, b) => b.score - a.score);
    return candidates;
  }

  // ë‹¨ì–´ë¥¼ ì‹¤ì œë¡œ ë°°ì¹˜í•˜ëŠ” í•¨ìˆ˜
  function placeWord(q, pos) {
    q.x = pos.x; q.y = pos.y; q.dir = pos.dir;
    [...q.answer].forEach((char, k) => {
      const cx = q.dir === 'across' ? q.x + k : q.x;
      const cy = q.dir === 'across' ? q.y : q.y + k;
      solution[cy][cx] = char;
    });
    if (!numberMap[q.y][q.x]) numberMap[q.y][q.x] = num++;
    const finalWord = {...q, num: numberMap[q.y][q.x]};
    if (q.dir === 'across') QUIZ.across.push(finalWord);
    else QUIZ.down.push(finalWord);
    placedWords.push(finalWord);
    usedAnswers.add(q.answer + '::' + q.clue);
    return true;
  }

  let attempts = 0;
  const maxAttempts = 15000;
  let retryPool = []; // ì´ë²ˆ ë¼ìš´ë“œì— ì‹¤íŒ¨í•œ ë‹¨ì–´ ë³´ê´€

  while ((pool.length > 0 || retryPool.length > 0) && placedWords.length < targetCount && attempts < maxAttempts) {
    
    // í’€ì´ ë¹„ë©´ retryPoolì—ì„œ ë‹¤ì‹œ ì±„ì›€
    if (pool.length === 0 && retryPool.length > 0) {
      pool.push(...retryPool.splice(0));
    }

    const q = pool.shift();
    const uniqueKey = q.answer + '::' + q.clue;
    if (usedAnswers.has(uniqueKey)) { attempts++; continue; }

    let placed = false;

    // â­ 1ë‹¨ê³„: êµì°¨ ë°°ì¹˜ - í•­ìƒ ì‹œë„, í›„ë³´ ì¤‘ ìµœê³  ì ìˆ˜ ìœ„ì¹˜ì— ë°°ì¹˜
    if (placedWords.length > 0) {
      const candidates = findAllOverlaps(q);
      if (candidates.length > 0) {
        // ì ìˆ˜ ìƒìœ„ 3ê°œ ì¤‘ ëœë¤ ì„ íƒ (ë„ˆë¬´ ê°™ì€ ìë¦¬ë§Œ ì“°ì§€ ì•Šë„ë¡)
        const topN = candidates.slice(0, Math.min(3, candidates.length));
        const best = topN[Math.floor(Math.random() * topN.length)];
        placed = placeWord(q, best);
      }
    }

    // â­ 2ë‹¨ê³„: êµì°¨ ì‹¤íŒ¨ ì‹œ ë…ë¦½ ë°°ì¹˜ (ë…ë¦½ ë°°ì¹˜ ë¹„ìœ¨ì„ ë‚®ì¶¤)
    if (!placed) {
      // êµì°¨ê°€ ë§ì´ ëì„ ë•Œë§Œ ë…ë¦½ ë°°ì¹˜ í—ˆìš© (ì „ì²´ì˜ 20% ì´í•˜)
      const crossRatio = placedWords.length > 0
        ? (placedWords.filter(w => {
            return placedWords.some(other =>
              other !== w && (
                (w.dir === 'across' && other.dir === 'down' &&
                  other.x >= w.x && other.x < w.x + w.answer.length &&
                  w.y >= other.y && w.y < other.y + other.answer.length) ||
                (w.dir === 'down' && other.dir === 'across' &&
                  w.x >= other.x && w.x < other.x + other.answer.length &&
                  other.y >= w.y && other.y < w.y + w.answer.length)
              )
            );
          }).length / placedWords.length)
        : 0;

      // êµì°¨ìœ¨ì´ 50% ì´ìƒì´ê±°ë‚˜ ì•„ì§ ì´ˆë°˜ì´ë©´ ë…ë¦½ ë°°ì¹˜ í—ˆìš©
      if (crossRatio >= 0.5 || placedWords.length < 5) {
        const direction = Math.random() < 0.5 ? 'across' : 'down';
        const emptyPos = findEmptySpace(q.answer.length, direction);
        if (emptyPos) {
          placed = placeWord(q, { ...emptyPos, dir: direction });
        }
      } else {
        // êµì°¨ìœ¨ì´ ë‚®ìœ¼ë©´ retryë¡œ ë³´ë‚´ì„œ ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‹œë„
        retryPool.push(q);
        placed = true; // ë¬´í•œë£¨í”„ ë°©ì§€
      }
    }

    if (!placed) retryPool.push(q);
    attempts++;
  }
  
  const crossCount = placedWords.filter(w =>
    placedWords.some(other =>
      other !== w && (
        (w.dir === 'across' && other.dir === 'down' &&
          other.x >= w.x && other.x < w.x + w.answer.length &&
          w.y >= other.y && w.y < other.y + other.answer.length) ||
        (w.dir === 'down' && other.dir === 'across' &&
          w.x >= other.x && w.x < other.x + other.answer.length &&
          other.y >= w.y && other.y < w.y + w.answer.length)
      )
    )
  ).length;
  console.log(`âœ… ë°°ì¹˜ì™„ë£Œ ê°€ë¡œ:${QUIZ.across.length} ì„¸ë¡œ:${QUIZ.down.length} êµì°¨ìœ¨:${Math.round(crossCount/placedWords.length*100)}%`);
  
  console.log(`âœ… ë°°ì¹˜ ì™„ë£Œ - ê°€ë¡œ: ${QUIZ.across.length}ê°œ, ì„¸ë¡œ: ${QUIZ.down.length}ê°œ, ì´: ${placedWords.length}ê°œ`);
  
  const totalCells = SIZE * SIZE;
  const filledCells = solution.flat().filter(c => c !== null).length;
  const density = ((filledCells / totalCells) * 100).toFixed(1);
  console.log(`ğŸ“Š ì¹¸ ì±„ì›€ìœ¨: ${filledCells}/${totalCells} (${density}%)`);
}


/* =====================
   4. UI ì œì–´ ë° ì´ë²¤íŠ¸ ì²˜ë¦¬
===================== */
function renderClues(){
  acrossList.innerHTML=""; downList.innerHTML="";
  [...QUIZ.across].sort((a,b)=>a.num - b.num).forEach(q=>{
    acrossList.innerHTML += `<div class="question" onclick="focusCell(${q.x}, ${q.y})">${q.num}. ${q.clue}</div>`;
  });
  [...QUIZ.down].sort((a,b)=>a.num - b.num).forEach(q=>{
    downList.innerHTML += `<div class="question" onclick="focusCell(${q.x}, ${q.y})">${q.num}. ${q.clue}</div>`;
  });
}

function focusCell(x, y) {
  if (solution[y][x] === null) return;

  // ì¡°í•© ì¤‘ì´ë˜ ê¸€ì í™•ì •
  if (composingChar && cursor.x !== null && cursor.y !== null) {
    grid[cursor.y][cursor.x] = composingChar;
    composingChar = "";
    composing = false;
  }

  cursor = { x, y };
  updateHint(x, y);

  // â˜… cellInputì„ ì„ íƒëœ ì…€ ìœ„ì— ì •í™•íˆ ìœ„ì¹˜ì‹œí‚´
  // canvasì˜ CSS í‘œì‹œ í¬ê¸° ê¸°ì¤€ìœ¼ë¡œ ì…€ ìœ„ì¹˜ ê³„ì‚°
  const canvasRect = canvas.getBoundingClientRect();
  const gameAreaRect = canvas.parentElement.getBoundingClientRect();
  const cssScale = canvasRect.width / canvas.width; // CSSí¬ê¸°/ì‹¤ì œí•´ìƒë„
  const cellCSSSize = CELL * cssScale;

  input.style.left = (canvasRect.left - gameAreaRect.left + x * cellCSSSize) + "px";
  input.style.top  = (canvasRect.top  - gameAreaRect.top  + y * cellCSSSize) + "px";
  input.style.width  = cellCSSSize + "px";
  input.style.height = cellCSSSize + "px";
  input.value = "";

  // í¬ì»¤ìŠ¤ (preventScrollë¡œ í™”ë©´ ì í”„ ë°©ì§€)
  input.focus({ preventScroll: true });
  draw();
}

function updateHint(x,y){
  let a="", d="";
  QUIZ.across.forEach(q=>{ if(y===q.y && x>=q.x && x<q.x+q.answer.length) a=q.clue; });
  QUIZ.down.forEach(q=>{ if(x===q.x && y>=q.y && y<q.y+q.answer.length) d=q.clue; });
  hintBox.innerHTML=`ğŸ‘‰ ì„ íƒëœ íŒíŠ¸
${a?`ê°€ë¡œ: ${a}
`:""}${d?`ì„¸ë¡œ: ${d}`:""}`;
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let y=0;y<SIZE;y++){
    for(let x=0;x<SIZE;x++){
      const active = solution[y][x] !== null;
      ctx.fillStyle = active ? "#fff" : "#666";
      ctx.fillRect(x*CELL,y*CELL,CELL,CELL);
      ctx.strokeStyle = "#ccc";
      ctx.strokeRect(x*CELL,y*CELL,CELL,CELL);

      if(active && numberMap[y][x]){
        ctx.fillStyle = "rgba(255,255,255,0.9)";
        ctx.fillRect(x*CELL+1, y*CELL+1, 10, 10);
        ctx.fillStyle="#0073e6"; ctx.font="bold 10px sans-serif";
        ctx.textAlign="left"; ctx.textBaseline="top";
        ctx.fillText(numberMap[y][x], x*CELL+2, y*CELL+1);
      }

      if(cursor.x===x && cursor.y===y){
        ctx.fillStyle="rgba(0,115,230,0.15)";
        ctx.fillRect(x*CELL,y*CELL,CELL,CELL);
      }

      let char = grid[y][x];
      if(cursor.x===x && cursor.y===y && composingChar) char = composingChar;

      if(char){
        ctx.fillStyle = char===solution[y][x] ? "#000" : "red";
        ctx.font="bold 18px sans-serif";
        ctx.textAlign="center";
        ctx.textBaseline="middle";
        ctx.fillText(char,x*CELL+15,y*CELL+15);
      }
    }
  }
}

/* =====================
   5. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
===================== */
// â­ ìº”ë²„ìŠ¤ ì‹¤ì œ í‘œì‹œ í¬ê¸° vs ë‚´ë¶€ í•´ìƒë„ ë¹„ìœ¨ ê³„ì‚° (ëª¨ë°”ì¼ ëŒ€ì‘ í•µì‹¬)
function getCanvasPos(e) {
  const r = canvas.getBoundingClientRect();
  const scaleX = canvas.width  / r.width;  // CSS í¬ê¸° ëŒ€ë¹„ ë‚´ë¶€ í•´ìƒë„ ë¹„ìœ¨
  const scaleY = canvas.height / r.height;
  
  let clientX, clientY;
  if (e.touches) {
    clientX = e.touches[0].clientX;
    clientY = e.touches[0].clientY;
  } else {
    clientX = e.clientX;
    clientY = e.clientY;
  }
  
  const x = Math.floor((clientX - r.left) * scaleX / CELL);
  const y = Math.floor((clientY - r.top)  * scaleY / CELL);
  return { x, y };
}

canvas.addEventListener("click", e => {
  const { x, y } = getCanvasPos(e);
  focusCell(x, y);
});

// â­ ëª¨ë°”ì¼ í„°ì¹˜: íƒ­ì€ ì…€ ì„ íƒ, ìŠ¤ì™€ì´í”„ëŠ” ìŠ¤í¬ë¡¤ í—ˆìš©
let touchStartX = 0, touchStartY = 0;

canvas.addEventListener("touchstart", e => {
  touchStartX = e.touches[0].clientX;
  touchStartY = e.touches[0].clientY;
  // preventDefault ì•ˆ í•¨ â†’ ìŠ¤í¬ë¡¤ í—ˆìš©
}, { passive: true });

canvas.addEventListener("touchend", e => {
  const dx = Math.abs(e.changedTouches[0].clientX - touchStartX);
  const dy = Math.abs(e.changedTouches[0].clientY - touchStartY);

  // 5px ì´ë‚´ ì›€ì§ì„ë§Œ íƒ­ìœ¼ë¡œ ì¸ì‹ (ìŠ¤ì™€ì´í”„ëŠ” ë¬´ì‹œ)
  if (dx < 5 && dy < 5) {
    const touch = e.changedTouches[0];
    const fakeEvent = { clientX: touch.clientX, clientY: touch.clientY };
    const { x, y } = getCanvasPos(fakeEvent);
    focusCell(x, y);
  }
}, { passive: true });

document.addEventListener("keydown",e=>{
  if(cursor.x===null) return;
  let {x,y}=cursor;
  if(e.key==="ArrowRight") x++;
  if(e.key==="ArrowLeft") x--;
  if(e.key==="ArrowDown") y++;
  if(e.key==="ArrowUp") y--;
  if(solution[y] && solution[y][x]!==null){
    cursor={x,y}; updateHint(x,y); draw();
  }
});

// =====================
// í•œê¸€ ì…ë ¥ - cellInput ë°©ì‹
// iOS/Android/PC ëª¨ë‘ ë™ì¼í•˜ê²Œ ë™ì‘
// í•µì‹¬: input.valueë¥¼ ì ˆëŒ€ ê°•ì œë¡œ ì§€ìš°ì§€ ì•ŠìŒ
//       â†’ ì´ì „ê°’ê³¼ í˜„ì¬ê°’ ë¹„êµë¡œ ìƒˆ ê¸€ì ê°ì§€
// =====================

// iOS: input.valueê°€ "ã„±ã…"ë¡œ ë‚¨ì„ ë•Œ ìëª¨ë¥¼ ì™„ì„±í˜• í•œê¸€ë¡œ ì¡°í•© (ìœ ë‹ˆì½”ë“œ 0xAC00 ê³µì‹)
function combineJamos(jamoStr) {
  if (!jamoStr) return "";
  const CHO = "ã„±ã„²ã„´ã„·ã„¸ã„¹ã…ã…‚ã…ƒã……ã…†ã…‡ã…ˆã…‰ã…Šã…‹ã…Œã…ã…";
  const JUNG = "ã…ã…ã…‘ã…’ã…“ã…”ã…•ã…–ã…—ã…˜ã…™ã…šã…›ã…œã…ã…ã…Ÿã… ã…¡ã…¢ã…£";
  const JONG = " ã„±ã„²ã„³ã„´ã„µã„¶ã„·ã„¹ã„ºã„»ã„¼ã„½ã„¾ã„¿ã…€ã…ã…‚ã…„ã……ã…†ã…‡ã…ˆã…Šã…‹ã…Œã…ã…";
  let result = "", cho = -1, jung = -1, jong = 0;
  for (let i = 0; i < jamoStr.length; i++) {
    const c = jamoStr[i];
    const iCho = CHO.indexOf(c), iJung = JUNG.indexOf(c), iJong = JONG.indexOf(c);
    if (iCho >= 0) {
      if (cho >= 0 && jung >= 0 && jong > 0) {
        result += String.fromCharCode(0xAC00 + ((cho * 21) + jung) * 28 + jong);
        cho = iCho; jung = -1; jong = 0;
      } else if (cho >= 0 && jung >= 0 && jong === 0 && iJong >= 0) {
        jong = iJong;
      } else { cho = iCho; jung = -1; jong = 0; }
    } else if (iJung >= 0) {
      if (cho >= 0) { jung = iJung; }
      else { result += c; cho = -1; jung = -1; jong = 0; }
    } else if (iJong >= 0 && cho >= 0 && jung >= 0) {
      if (jong === 0) { jong = iJong; }
      else {
        result += String.fromCharCode(0xAC00 + ((cho * 21) + jung) * 28 + jong);
        cho = iCho >= 0 ? iCho : -1; jung = -1; jong = 0;
      }
    } else { result += c; cho = -1; jung = -1; jong = 0; }
  }
  if (cho >= 0 && jung >= 0) result += String.fromCharCode(0xAC00 + ((cho * 21) + jung) * 28 + jong);
  return result;
}

// ë°›ì¹¨ ì¶”ê°€: "ê°€" + "ã„´" â†’ "ê°„", "ê°‘" + "ã……" â†’ "ê°’" (ë³µí•©ë°›ì¹¨ í¬í•¨)
function addJongToSyllable(syllable, jongJamo) {
  const code = syllable.charCodeAt(0);
  if (code < 0xAC00 || code > 0xD7A3) return null;
  const JONG = " ã„±ã„²ã„³ã„´ã„µã„¶ã„·ã„¹ã„ºã„»ã„¼ã„½ã„¾ã„¿ã…€ã…ã…‚ã…„ã……ã…†ã…‡ã…ˆã…Šã…‹ã…Œã…ã…";
  const newIdx = JONG.indexOf(jongJamo);
  if (newIdx <= 0) return null;
  const temp = code - 0xAC00;
  const curJong = temp % 28;
  const jung = Math.floor(temp / 28) % 21;
  const cho = Math.floor(temp / 28 / 21);
  let finalJong = 0;
  if (curJong === 0) {
    finalJong = newIdx;
  } else {
    // ë³µí•©ë°›ì¹¨: ã„±+ã……=ã„³, ã„´+ã…ˆ=ã„µ, ã„´+ã…=ã„¶, ã„¹+ã„±=ã„º, ã„¹+ã…=ã„», ã„¹+ã…‚=ã„¼, ã„¹+ã……=ã„½, ã„¹+ã…Œ=ã„¾, ã„¹+ã…=ã„¿, ã„¹+ã…=ã…€, ã…‚+ã……=ã…„
    const compound = { "1,19": 3, "4,22": 5, "4,27": 6, "8,1": 9, "8,16": 10, "8,17": 11, "8,19": 12, "8,25": 13, "8,26": 14, "8,27": 15, "17,19": 18 };
    const key = curJong + "," + newIdx;
    finalJong = compound[key] || 0;
  }
  if (finalJong === 0) return null;
  return String.fromCharCode(0xAC00 + ((cho * 21) + jung) * 28 + finalJong);
}

function extractKorean(str) {
  if (!str) return "";
  // ì™„ì„±í˜• í•œê¸€ ìš°ì„ 
  const full = str.match(/[ê°€-í£]/g);
  if (full) return full[full.length - 1];
  // ìëª¨ë§Œ ìˆëŠ” ê²½ìš°: iOSì—ì„œ "ã„±ã…"ê°€ "ê°€"ë¡œ ì•ˆ ë°”ë€” ë•Œ ì§ì ‘ ì¡°í•©
  const jamo = str.match(/[ã„±-ã…ã…-ã…£]/g);
  if (jamo) {
    const combined = combineJamos(jamo.join(""));
    if (combined) return combined[combined.length - 1];
    return jamo[jamo.length - 1];
  }
  return "";
}

let prevVal = ""; // ì§ì „ input.value
let justFinishedComposition = false; // ëª¨ë°”ì¼: compositionendì—ì„œ ì§€ì—° ì²˜ë¦¬í•  ë•Œ input ì´ë²¤íŠ¸ ìŠ¤í‚µìš©

input.addEventListener("compositionstart", () => {
  composing = true;
  composingChar = "";
});

input.addEventListener("compositionupdate", () => {
  // input.valueë¡œ ë¯¸ë¦¬ë³´ê¸° (e.dataëŠ” iOSì—ì„œ ë¯¿ì„ ìˆ˜ ì—†ìŒ)
  const ch = extractKorean(input.value);
  if (ch) { composingChar = ch; draw(); }
});

input.addEventListener("compositionend", () => {
  composing = false;
  // ëª¨ë°”ì¼: input.valueê°€ "ã„±ã…"â†’"ê°€"ë¡œ ê°±ì‹ ë˜ê¸° ì „ì— input ì´ë²¤íŠ¸ê°€ ì˜¤ë©´
  // extractKoreanì´ ë§ˆì§€ë§‰ ìëª¨ "ã…"ë§Œ ë°˜í™˜í•˜ëŠ” ë²„ê·¸ ë°©ì§€
  // â†’ setTimeoutìœ¼ë¡œ ë‹¤ìŒ í‹±ì— ì²˜ë¦¬ (ë¸Œë¼ìš°ì €ê°€ ê°’ ê°±ì‹  ì™„ë£Œ í›„)
  justFinishedComposition = true;
  setTimeout(() => {
    if (cursor.x === null || cursor.y === null) {
      justFinishedComposition = false;
      return;
    }
    const val = input.value;
    const curCell = grid[cursor.y][cursor.x];
    const singleJamo = val.length === 1 && /[ã„±-ã…]/.test(val);
    if (singleJamo && curCell && /[ê°€-í£]/.test(curCell)) {
      const withJong = addJongToSyllable(curCell, val);
      if (withJong) {
        grid[cursor.y][cursor.x] = withJong;
        composingChar = "";
        input.value = "";
        prevVal = "";
        draw();
        justFinishedComposition = false;
        return;
      }
    }
    const ch = extractKorean(val);
    if (ch) {
      grid[cursor.y][cursor.x] = ch;
      composingChar = "";
      input.value = "";
      prevVal = "";
      draw();
    }
    justFinishedComposition = false;
  }, 10);
});

input.addEventListener("input", () => {
  if (cursor.x === null || cursor.y === null) return;
  // ëª¨ë°”ì¼ í•œê¸€ ì¡°í•©: compositionendì˜ setTimeoutì—ì„œ ì²˜ë¦¬í•˜ë¯€ë¡œ ì—¬ê¸°ì„œ ìŠ¤í‚µ
  if (justFinishedComposition) return;

  const val = input.value;

  if (composing) {
    // ì¡°í•© ì¤‘: ë¯¸ë¦¬ë³´ê¸°ë§Œ
    composingChar = extractKorean(val) || "";
    draw();
    prevVal = val;
    return;
  }

  // â”€â”€ ì¡°í•© ì™„ë£Œ or ë‹¨íƒ€ ì…ë ¥ â”€â”€

  // ìƒˆë¡œ ì¶”ê°€ëœ ë¶€ë¶„ ê³„ì‚° (prevValê³¼ì˜ ì°¨ì´)
  let newPart = val;
  if (val.startsWith(prevVal) && prevVal.length > 0) {
    newPart = val.slice(prevVal.length);
  }

  prevVal = val;

  if (!newPart && !val) return;

  // ì‹¤ì œ ì €ì¥í•  ê¸€ì: ìƒˆ ë¶€ë¶„ ìš°ì„ , ì—†ìœ¼ë©´ ì „ì²´ ë§ˆì§€ë§‰ ê¸€ì
  const target = newPart || val;

  // ì˜ë¬¸/ìˆ«ì ì…ë ¥ ì‹œ ê²½ê³  (PC í•œê¸€ ëª¨ë“œê°€ ì•„ë‹ ë•Œ)
  if (target && /[a-zA-Z0-9]/.test(target[0])) {
    showToast("âš ï¸ í•œê¸€ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”!<br>í‚¤ë³´ë“œë¥¼ í•œê¸€ ëª¨ë“œë¡œ ë³€ê²½í•´ì£¼ì„¸ìš”.");
    input.value = ""; prevVal = "";
    return;
  }

  const ch = extractKorean(target);
  if (!ch) return;

  // iOS Chrome: "ê°€" + "ã„´" â†’ "ê°„" (ë°›ì¹¨ ì¶”ê°€)
  // í˜„ì¬ ì…€ì— ë°›ì¹¨ ì—†ëŠ” í•œê¸€ì´ ìˆê³ , ìƒˆë¡œ ë“¤ì–´ì˜¨ ê²Œ ë°›ì¹¨ ê°€ëŠ¥í•œ ììŒ í•œ ê¸€ìì¼ ë•Œ
  const curCell = grid[cursor.y][cursor.x];
  const singleJamo = val.length === 1 && /[ã„±-ã…]/.test(val);
  if (singleJamo && curCell && /[ê°€-í£]/.test(curCell)) {
    const withJong = addJongToSyllable(curCell, val);
    if (withJong) {
      grid[cursor.y][cursor.x] = withJong;
      composingChar = "";
      input.value = "";
      prevVal = "";
      draw();
      return;
    }
  }

  // iOS Chrome: ìëª¨ë§Œ ìˆê³  ì™„ì„±í˜• ìŒì ˆì´ ì•„ë‹ˆë©´ ì•„ì§ ì»¤ë°‹í•˜ì§€ ì•ŠìŒ
  // "ã„±" ì…ë ¥ í›„ "ã…"ê°€ ì˜¬ ë•Œê¹Œì§€ ëŒ€ê¸° â†’ "ã„±ã…"ê°€ ë˜ë©´ "ê°€"ë¡œ ì¡°í•©í•´ì„œ ì»¤ë°‹
  const jamo = val.match(/[ã„±-ã…ã…-ã…£]/g);
  const hasComplete = /[ê°€-í£]/.test(val);
  const combined = jamo ? combineJamos(jamo.join("")) : "";
  const hasCompleteSyllable = hasComplete || (combined && combined.length > 0);
  if (!hasCompleteSyllable && jamo && jamo.length > 0) {
    // ì¡°í•© ì¤‘ì¸ ìëª¨ë§Œ ìˆìŒ â†’ ë¯¸ë¦¬ë³´ê¸°ë§Œ, ì»¤ë°‹/ì´ˆê¸°í™” ì•ˆ í•¨ (ë‹¤ìŒ í‚¤ ì…ë ¥ ëŒ€ê¸°)
    composingChar = ch;
    draw();
    return;
  }

  grid[cursor.y][cursor.x] = ch;
  composingChar = "";

  // â˜… input.value ì´ˆê¸°í™”ëŠ” ì¡°í•©ì´ ì™„ì „íˆ ëë‚¬ì„ ë•Œë§Œ
  if (!composing) {
    input.value = "";
    prevVal = "";
  }

  draw();
});

input.addEventListener("keydown", e => {
  if (e.key === "Backspace") {
    e.preventDefault();
    if (cursor.x !== null) {
      grid[cursor.y][cursor.x] = "";
      composingChar = "";
      composing = false;
      input.value = "";
      prevVal = "";
      draw();
    }
  }
});

/* =====================
   6. [ì¤‘ìš”] auth.js í†µí•© ê¸°ëŠ¥ ì œì–´
===================== */

let isCountingDown = false; 

function handlePremiumFeature(type) {
  // [auth.js í™œìš©] í˜„ì¬ ì‚¬ìš©ì ìƒíƒœ í™•ì¸
  const user = checkAuthStatus();

  // 1. ì¸ì‡„ ê¸°ëŠ¥
  if (type === 'print') {
    if (!user) {
      if (confirm("ğŸ–¨ï¸ ì¸ì‡„ ê¸°ëŠ¥ì€ í›„ì›ì ì „ìš©ì…ë‹ˆë‹¤.\ní›„ì› í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        window.location.href = 'support.html';
      }
      return;
    }
    
    // ìˆ˜ëŸ‰ ì²´í¬ ë° í”„ë¡œì„¸ìŠ¤ ì‹œì‘
    if (user.printCount <= 0) {
      alert("ì‚¬ìš© ê°€ëŠ¥í•œ ì¸ì‡„ ìˆ˜ëŸ‰ì„ ëª¨ë‘ ì†Œì§„í•˜ì…¨ìŠµë‹ˆë‹¤.");
      return;
    }
    
    // ì‹¤ì œ ì¸ì‡„ ì…ë ¥ì°½ ë„ìš°ê¸° (ê¸°ì¡´ í•¨ìˆ˜ í˜¸ì¶œ)
    processPrint();
    return;
  }

  // 2. ì •ë‹µ ë³´ê¸° ê¸°ëŠ¥
  if (type === 'answer') {
    if (user) {
      showAllAnswers(); // í›„ì›ìëŠ” ì¦‰ì‹œ ê³µê°œ
    } else {
      const adPopup = document.getElementById('adPopup');
      if (adPopup) {
        adPopup.style.display = 'flex';
        document.getElementById('popupChoice').style.display = 'block';
        document.getElementById('popupTimerArea').style.display = 'none';
      } else {
        startWaitingTimer();
      }
    }
  }
}

// íŒì—… ë‚´ [30ì´ˆ ëŒ€ê¸° í›„ ë¬´ë£Œ ë³´ê¸°] í´ë¦­ ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
function startWaitingTimer() {
  if (isCountingDown) return;

  const choiceArea = document.getElementById('popupChoice');
  const timerArea = document.getElementById('popupTimerArea');
  const adTimerText = document.getElementById('adTimerText');
  const closeAdBtn = document.getElementById('closeAdBtn');
  const mainBtn = document.getElementById('btnAnswer') || document.querySelector("button[onclick*='answer']");

  if (choiceArea) choiceArea.style.display = 'none';
  if (timerArea) timerArea.style.display = 'block';
  
  let timeLeft = 30;
  isCountingDown = true;
  if (mainBtn) {
    mainBtn.disabled = true;
    mainBtn.style.opacity = "0.6";
  }

  

  const timer = setInterval(() => {
    if (adTimerText) adTimerText.innerText = `${timeLeft}ì´ˆ í›„ ì •ë‹µì´ ê³µê°œë©ë‹ˆë‹¤`;
    if (mainBtn) mainBtn.innerText = `â³ ${timeLeft}ì´ˆ...`;
    
    if (timeLeft <= 0) {
      clearInterval(timer);
      isCountingDown = false;
      
      if (adTimerText) adTimerText.innerText = "âœ¨ ì •ë‹µì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!";
      if (closeAdBtn) closeAdBtn.style.display = 'block';
      
      if (mainBtn) {
        mainBtn.disabled = false;
        mainBtn.style.opacity = "1";
        mainBtn.innerText = "ğŸ” ì •ë‹µë³´ê¸°";
      }
      
      showAllAnswers();
    }
    timeLeft--;
  }, 1000);
}

// íŒì—… ë‹«ê¸° í•¨ìˆ˜
function closeAdPopup() {
  if (isCountingDown) {
    alert("ì•„ì§ ì •ë‹µì„ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”!");
    return;
  }
  document.getElementById('adPopup').style.display = 'none';
  if (document.getElementById('closeAdBtn')) {
    document.getElementById('closeAdBtn').style.display = 'none';
  }
}

// [ì‹¤ì œ ì •ë‹µ ì£¼ì… í•¨ìˆ˜]
function showAllAnswers() {
  if (!solution || solution.length === 0) {
    alert("í¼ì¦ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }
  for (let y = 0; y < SIZE; y++) {
    for (let x = 0; x < SIZE; x++) {
      if (solution[y][x] !== null) {
        grid[y][x] = solution[y][x]; 
      }
    }
  }
  if (typeof draw === 'function') {
    draw(); 
    alert("âœ¨ ëª¨ë“  ì •ë‹µì´ ì±„ì›Œì¡ŒìŠµë‹ˆë‹¤!");
  }
}

/* =====================
   7. ì¸ì‡„ ë¡œì§ ë° í†µê³„ ì „ì†¡
===================== */
function sendPrintLogToGoogle(church, memo) {
  const now = new Date().toLocaleString('ko-KR', {
    year: 'numeric', month: '2-digit', day: '2-digit',
    hour: '2-digit', minute: '2-digit', hour12: false
  });
  const puzzleTitle = document.getElementById('dynamicTitle')?.innerText
                   || document.title
                   || 'ì„±ê²½ í¼ì¦';

  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // ë°©ë²• 1: Google Apps Script ì›¹ì•± (ê¶Œì¥ - ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì— í™•ì‹¤íˆ ê¸°ë¡ë¨)
  //   ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì—ì„œ í™•ì¥ í”„ë¡œê·¸ë¨ â†’ Apps Script â†’ ì•„ë˜ ì½”ë“œ ë¶™ì—¬ë„£ê³ 
  //   "ì›¹ ì•±ìœ¼ë¡œ ë°°í¬" â†’ URL ë³µì‚¬ í›„ ì•„ë˜ì— ë¶™ì—¬ë„£ê¸°
  const PRINT_LOG_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzm9FOz5JX8Zl2Tfk9FV9cQltjODToRyykUdLoBpVevn0b_47Y8WgLLuyR0u4oDIoDS/exec";
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  if (PRINT_LOG_WEB_APP_URL) {
    // ì›¹ì•±ìœ¼ë¡œ ì „ì†¡ (í¼ POST â†’ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì— ë°”ë¡œ í•œ í–‰ ì¶”ê°€)
    let iframe = document.getElementById('google-form-iframe');
    if (!iframe) {
      iframe = document.createElement('iframe');
      iframe.id = 'google-form-iframe';
      iframe.name = 'google-form-iframe';
      iframe.style.cssText = 'position:absolute;width:0;height:0;border:0;visibility:hidden';
      document.body.appendChild(iframe);
    }
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = PRINT_LOG_WEB_APP_URL;
    form.target = 'google-form-iframe';
    form.style.display = 'none';
    [
      ['church', church],
      ['memo', memo],
      ['date', now],
      ['puzzle', puzzleTitle]
    ].forEach(([name, value]) => {
      const input = document.createElement('input');
      input.type = 'hidden';
      input.name = name;
      input.value = value || '';
      form.appendChild(input);
    });
    document.body.appendChild(form);
    form.submit();
    document.body.removeChild(form);
    console.log("âœ… ì›¹ì•± ì „ì†¡ ì‹œë„:", { church, memo, now, puzzleTitle });
    return Promise.resolve(true);
  }

  // ë°©ë²• 2: êµ¬ê¸€í¼ formResponse (í¼ì—ì„œ "ë¡œê·¸ì¸ ì—†ì´ ì‘ë‹µ" í—ˆìš© í•„ìš”)
  const FORM_ID      = "1FAIpQLScBklbfEP5ynC55J7-J5lGw6Ilmysol2AGzCRFF4K4PdV8rUg";
  const ENTRY_CHURCH = "entry.1456386806";
  const ENTRY_MEMO   = "entry.1011687614";
  const ENTRY_DATE   = "entry.1586908192";
  const ENTRY_PUZZLE = "entry.1902615179";
  const formUrl = `https://docs.google.com/forms/d/e/${FORM_ID}/formResponse`;

  let iframe = document.getElementById('google-form-iframe');
  if (!iframe) {
    iframe = document.createElement('iframe');
    iframe.id = 'google-form-iframe';
    iframe.name = 'google-form-iframe';
    iframe.style.cssText = 'position:absolute;width:0;height:0;border:0;visibility:hidden';
    document.body.appendChild(iframe);
  }
  const form = document.createElement('form');
  form.method = 'POST';
  form.action = formUrl;
  form.target = 'google-form-iframe';
  form.style.display = 'none';
  [
    [ENTRY_CHURCH, church],
    [ENTRY_MEMO, memo],
    [ENTRY_DATE, now],
    [ENTRY_PUZZLE, puzzleTitle]
  ].forEach(([name, value]) => {
    const input = document.createElement('input');
    input.type = 'hidden';
    input.name = name;
    input.value = value || '';
    form.appendChild(input);
  });
  document.body.appendChild(form);
  form.submit();
  document.body.removeChild(form);
  console.log("âœ… êµ¬ê¸€í¼ ì „ì†¡ ì‹œë„:", { church, memo, now, puzzleTitle });
  return Promise.resolve(true);
}

async function processPrint() {
  const church = prompt("êµíšŒëª…ì„ ì…ë ¥í•˜ì„¸ìš”.", "ë¡œì„¸ë¡œêµíšŒ") || "ë¯¸ì§€ì •êµíšŒ";
  const memo = prompt("ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”", "ì´ˆë“± 1ë¶€ ì£¼ì¼í•™êµ êµì¬") || "";

  console.log("ğŸ“‹ ì…ë ¥ëœ ì •ë³´:", { church, memo });

  // 1. í”„ë¦°íŠ¸ ì˜ì—­ í‘œì‹œ
  const printWrapper = document.getElementById('print-wrapper');
  if (!printWrapper) { alert("í”„ë¦°íŠ¸ ì˜ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."); return; }
  printWrapper.style.display = 'block';

  // 2. í—¤ë” í…ìŠ¤íŠ¸ ì±„ìš°ê¸°
  document.getElementById('target-church-name').innerText = church || 'ë¯¸ì§€ì •êµíšŒ';
  document.getElementById('target-top-memo').innerText = memo || 'â€”';

  // 3. í¼ì¦ ìº”ë²„ìŠ¤ ë³µì‚¬ (ê³ í•´ìƒë„ - 900x900)
  const printCanvas = document.getElementById('print-canvas');
  const printCtx = printCanvas.getContext('2d');
  const PCELL = 60; // 900 / 15 = 60px per cell

  printCanvas.width = SIZE * PCELL;
  printCanvas.height = SIZE * PCELL;

  for (let y = 0; y < SIZE; y++) {
    for (let x = 0; x < SIZE; x++) {
      const active = solution[y][x] !== null;
      // ë°°ê²½
      printCtx.fillStyle = active ? "#ffffff" : "#555555";
      printCtx.fillRect(x*PCELL, y*PCELL, PCELL, PCELL);
      // í…Œë‘ë¦¬
      printCtx.strokeStyle = active ? "#aaaaaa" : "#444444";
      printCtx.lineWidth = 0.5;
      printCtx.strokeRect(x*PCELL, y*PCELL, PCELL, PCELL);

      if (active && numberMap[y][x]) {
        // ë²ˆí˜¸ ë°°ê²½
        printCtx.fillStyle = "rgba(255,255,255,0.95)";
        printCtx.fillRect(x*PCELL+1, y*PCELL+1, 18, 16);
        // ë²ˆí˜¸
        printCtx.fillStyle = "#0073e6";
        printCtx.font = "bold 13px sans-serif";
        printCtx.textAlign = "left";
        printCtx.textBaseline = "top";
        printCtx.fillText(numberMap[y][x], x*PCELL+2, y*PCELL+2);
      }

      // ì…ë ¥ëœ ê¸€ì
      const char = grid[y][x];
      if (char) {
        printCtx.fillStyle = (char === solution[y][x]) ? "#000000" : "#cc0000";
        printCtx.font = "bold 28px sans-serif";
        printCtx.textAlign = "center";
        printCtx.textBaseline = "middle";
        printCtx.fillText(char, x*PCELL + PCELL/2, y*PCELL + PCELL/2);
      }
    }
  }

  // 4. íŒíŠ¸ ë³µì‚¬
  document.getElementById('print-across-list').innerHTML = document.getElementById('acrossList').innerHTML;
  document.getElementById('print-down-list').innerHTML = document.getElementById('downList').innerHTML;

  // 4-2. 2í˜ì´ì§€: ì •ë‹µ ìº”ë²„ìŠ¤ (solutionìœ¼ë¡œ ì±„ì›€)
  const ansCanvas = document.getElementById('print-canvas-answer');
  const ansCtx = ansCanvas.getContext('2d');
  ansCanvas.width = SIZE * PCELL;
  ansCanvas.height = SIZE * PCELL;
  for (let y = 0; y < SIZE; y++) {
    for (let x = 0; x < SIZE; x++) {
      const active = solution[y][x] !== null;
      ansCtx.fillStyle = active ? "#ffffff" : "#555555";
      ansCtx.fillRect(x*PCELL, y*PCELL, PCELL, PCELL);
      ansCtx.strokeStyle = active ? "#aaaaaa" : "#444444";
      ansCtx.lineWidth = 0.5;
      ansCtx.strokeRect(x*PCELL, y*PCELL, PCELL, PCELL);
      if (active && numberMap[y][x]) {
        ansCtx.fillStyle = "rgba(255,255,255,0.95)";
        ansCtx.fillRect(x*PCELL+1, y*PCELL+1, 18, 16);
        ansCtx.fillStyle = "#0073e6";
        ansCtx.font = "bold 13px sans-serif";
        ansCtx.textAlign = "left";
        ansCtx.textBaseline = "top";
        ansCtx.fillText(numberMap[y][x], x*PCELL+2, y*PCELL+2);
      }
      const char = solution[y][x];
      if (char) {
        ansCtx.fillStyle = "#000000";
        ansCtx.font = "bold 28px sans-serif";
        ansCtx.textAlign = "center";
        ansCtx.textBaseline = "middle";
        ansCtx.fillText(char, x*PCELL + PCELL/2, y*PCELL + PCELL/2);
      }
    }
  }

  // 5. QR ì½”ë“œ (ë©”ì¸í˜ì´ì§€ ë§í¬)
  const qrImg = document.getElementById('qr-img');
  const mainUrl = 'https://crossero.com';
  const qrApiUrl = 'https://api.qrserver.com/v1/create-qr-code/?size=120x120&margin=1&data=' + encodeURIComponent(mainUrl);
  qrImg.src = qrApiUrl;

  // 5-2. 2í˜ì´ì§€: êµíšŒ/ë©”ëª¨, íŒíŠ¸, QR
  document.getElementById('target-church-name-2').innerText = church || 'ë¯¸ì§€ì •êµíšŒ';
  document.getElementById('target-top-memo-2').innerText = memo || 'â€”';
  document.getElementById('print-across-list-2').innerHTML = document.getElementById('acrossList').innerHTML;
  document.getElementById('print-down-list-2').innerHTML = document.getElementById('downList').innerHTML;
  document.getElementById('qr-img-2').src = qrApiUrl;

  // 6. êµ¬ê¸€í¼ í†µê³„ ì „ì†¡ (ë°±ê·¸ë¼ìš´ë“œ)
  sendPrintLogToGoogle(church, memo).catch(() => {});

  // 7. ì¸ì‡„ ì¹´ìš´íŠ¸ ì°¨ê°
  deductPrintCount();

  // 8. QR ë¡œë“œ + ë Œë”ë§ ì™„ë£Œ í›„ ì¸ì‡„
  const originalTitle = document.title;
  const d = new Date();
  const pad = n => String(n).padStart(2, '0');
  const dateStr = `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
  const timeStr = `${pad(d.getHours())}-${pad(d.getMinutes())}-${pad(d.getSeconds())}`;
  document.title = `ì‹­ìê°€ë¡œì„¸ë¡œ_${church}_${dateStr}_${timeStr}`;
  const doPrint = () => {
    setTimeout(() => {
      window.print();
      document.title = originalTitle;
      printWrapper.style.display = 'none';
    }, 300);
  };
  if (qrImg.complete && qrImg.naturalWidth) {
    doPrint();
  } else {
    qrImg.onload = doPrint;
    qrImg.onerror = doPrint; // ì‹¤íŒ¨ ì‹œì—ë„ ì¸ì‡„ ì§„í–‰
  }
}

/* =====================
   8. ì´ˆê¸°í™” ë° SEO
===================== */
window.addEventListener('load', () => {
  const urlParams = new URLSearchParams(window.location.search);
  const quizId = urlParams.get('id');
  const query = urlParams.get('query');
  const answerParam = urlParams.get('answer');
  const gParam = urlParams.get('g');

  // â­ QR ì •ë‹µ í˜ì´ì§€: g= íŒŒë¼ë¯¸í„°ë¡œ í¼ì¦ ìƒíƒœ ë³µì›
  if (answerParam === '1' && gParam) {
    if (decodeAndRestorePuzzleAnswer(gParam)) {
      cursor = { x: null, y: null };
      if (acrossList) acrossList.innerHTML = '';
      if (downList) downList.innerHTML = '';
      if (hintBox) hintBox.innerHTML = 'ğŸ“± ì¸ì‡„ë¬¼ QRë¡œ ì—´ë¦° ì •ë‹µ ë³´ê¸°';
      draw();
      if (document.getElementById('dynamicTitle')) {
        document.getElementById('dynamicTitle').innerText = 'ì •ë‹µ ë³´ê¸° (ì¸ì‡„ í¼ì¦)';
      }
      return;
    }
  }

  // â­ 1ìˆœìœ„: quizIdê°€ ìˆìœ¼ë©´ data.jsì—ì„œ ì œëª© ê°€ì ¸ì˜¤ê¸°
  if (quizId && QUIZ_DATABASE[quizId]) {
    const quizData = QUIZ_DATABASE[quizId];
    
    // í˜ì´ì§€ í—¤ë” ì œëª© ë³€ê²½
    if (document.getElementById('dynamicTitle')) {
      document.getElementById('dynamicTitle').innerText = quizData.title;
    }
    
    // ë¸Œë¼ìš°ì € íƒ­ ì œëª© ë³€ê²½ (SEO)
    document.title = `${quizData.title} | ì‹­ìê°€ë¡œì„¸ë¡œ`;
    
    // ê²€ìƒ‰ ë¡œë´‡ì„ ìœ„í•œ description ë©”íƒ€íƒœê·¸ ë³€ê²½ (SEO)
    let metaDesc = document.querySelector('meta[name="description"]');
    if (metaDesc) {
      metaDesc.setAttribute("content", `${quizData.title} - ${quizData.category} ì„±ê²½ ë‚±ë§ í¼ì¦ì„ í’€ì–´ë³´ì„¸ìš”. ${quizData.meta}`);
    }
    
    // ê²€ìƒ‰ ë¡œë´‡ì„ ìœ„í•œ keywords ë©”íƒ€íƒœê·¸ ë³€ê²½ (SEO)
    let metaKeywords = document.querySelector('meta[name="keywords"]');
    if (metaKeywords) {
      metaKeywords.setAttribute("content", `${quizData.title}, ${quizData.category}, ì„±ê²½ í¼ì¦, ì‹­ìê°€ë¡œì„¸ë¡œ`);
    }
    
    // AEO: êµ¬ì¡°í™” ë°ì´í„° (Dataset, Quiz) + í¼ì¦ í•˜ë‹¨ ìš”ì•½
    injectAeoStructuredData(quizData, quizId);
    updatePuzzleSummary(quizId, quizData.title);
    
    console.log('âœ… SEO ì„¤ì • ì™„ë£Œ:', quizData.title);
  } 
  // â­ 2ìˆœìœ„: query íŒŒë¼ë¯¸í„°ê°€ ìˆìœ¼ë©´ (ê²€ìƒ‰ì–´ ê¸°ë°˜)
  else if (query) {
    const finalTitle = `ì„±ê²½ ${query} ê´€ë ¨ ë§ì”€ í¼ì¦`;
    if (document.getElementById('dynamicTitle')) {
      document.getElementById('dynamicTitle').innerText = finalTitle;
    }
    document.title = `${finalTitle} | ì‹­ìê°€ë¡œì„¸ë¡œ`;
    injectStructuredData(finalTitle);
  }
  // â­ 3ìˆœìœ„: ì•„ë¬´ê²ƒë„ ì—†ìœ¼ë©´ ê¸°ë³¸ ì œëª© (structured dataë§Œ ê¸°ë³¸í˜•)
  else {
    if (document.getElementById('dynamicTitle')) {
      document.getElementById('dynamicTitle').innerText = 'ë§ì”€ ê°€ë¡œì„¸ë¡œ í¼ì¦';
    }
  }

  loadAndTranslateData(); 
  setupQuiz(3); 
});

const canonicalLink = document.createElement('link');
canonicalLink.rel = 'canonical';
canonicalLink.href = window.location.origin + window.location.pathname;
document.head.appendChild(canonicalLink);

function injectStructuredData(title) {
  const existingScript = document.getElementById('jsonLdData');
  if (existingScript) existingScript.remove();
  const script = document.createElement('script');
  script.id = 'jsonLdData';
  script.type = 'application/ld+json';
  const puzzleData = {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": title || "ì„±ê²½ ë§ì”€ ê°€ë¡œì„¸ë¡œ í¼ì¦",
    "description": `${title} ì£¼ì œì˜ ì„±ê²½ ë‹¨ì–´ë¥¼ í™œìš©í•œ ì˜¨ë¼ì¸ ê°€ë¡œì„¸ë¡œ ë‚±ë§ ë§ì¶”ê¸° ê²Œì„ì…ë‹ˆë‹¤.`,
    "applicationCategory": "GameApplication",
    "operatingSystem": "Web",
    "author": { "@type": "Organization", "name": "ì‹­ìê°€ë¡œì„¸ë¡œ" },
    "url": window.location.href
  };
  script.text = JSON.stringify(puzzleData);
  document.head.appendChild(script);
}

/** AEO: í¼ì¦ë³„ Dataset + Quiz Schema ì£¼ì… (AI ê²€ìƒ‰ ì—”ì§„ ì¸ìš© ìœ ë„) */
function injectAeoStructuredData(quizData, quizId) {
  if (!quizData || !quizData.allWords) return;
  var baseUrl = 'https://crossero.com';
  var puzzleId = quizId || getQuizIdFromUrl();
  var puzzleUrl = baseUrl + '/play.html?id=' + encodeURIComponent(puzzleId);
  var words = quizData.allWords;
  var sampleWords = words.slice(0, 10);
  var questions = sampleWords.map(function(w) {
    return {
      "@type": "Question",
      "name": w.clue,
      "acceptedAnswer": { "@type": "Answer", "text": w.answer }
    };
  });
  var datasetSchema = {
    "@context": "https://schema.org",
    "@type": "Dataset",
    "name": quizData.title + " ì„±ê²½ ê°€ë¡œì„¸ë¡œ í¼ì¦ ë°ì´í„°ì…‹",
    "description": quizData.title + "ì˜ í•µì‹¬ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ ì œì‘ëœ êµìœ¡ìš© ê°€ë¡œì„¸ë¡œ í¼ì¦",
    "creator": { "@type": "Organization", "name": "ì‹­ìê°€ë¡œì„¸ë¡œ", "url": baseUrl },
    "keywords": [quizData.title, "ì„±ê²½ í€´ì¦ˆ", "ê°€ë¡œì„¸ë¡œ í¼ì¦", "ì£¼ì¼í•™êµ ìë£Œ"],
    "license": baseUrl + "/about.html",
    "url": puzzleUrl,
    "temporalCoverage": "2024/2026",
    "spatialCoverage": "ëŒ€í•œë¯¼êµ­",
    "hasPart": questions.slice(0, 5)
  };
  var quizSchema = {
    "@context": "https://schema.org",
    "@type": "Quiz",
    "about": { "@type": "Thing", "name": quizData.title },
    "educationalAlignment": {
      "@type": "AlignmentObject",
      "alignmentType": "educationalSubject",
      "targetName": "ì„±ê²½ êµìœ¡"
    },
    "hasPart": sampleWords.slice(0, 5).map(function(w) {
      var others = words.filter(function(x) { return x.answer !== w.answer; }).slice(0, 3).map(function(x) { return x.answer; });
      return {
        "@type": "Question",
        "eduQuestionType": "Short answer",
        "text": w.clue,
        "acceptedAnswer": { "@type": "Answer", "text": w.answer },
        "suggestedAnswer": [w.answer].concat(others).slice(0, 4).map(function(t) { return { "@type": "Answer", "text": t }; })
      };
    })
  };
  function appendLd(id, obj) {
    var ex = document.getElementById(id);
    if (ex) ex.remove();
    var script = document.createElement('script');
    script.id = id;
    script.type = 'application/ld+json';
    script.text = JSON.stringify(obj);
    document.head.appendChild(script);
  }
  appendLd('jsonLdDataset', datasetSchema);
  appendLd('jsonLdQuiz', quizSchema);
  injectStructuredData(quizData.title);
}
function getQuizIdFromUrl() {
  var p = new URLSearchParams(window.location.search);
  return p.get('id') || '';
}

/** AEO: ì„±ê²½ ê¶Œë³„ ìš”ì•½ (í¼ì¦ í•˜ë‹¨ ë¸”ë¡ìš©, AI ì¸ìš© ìœ ë„) */
var PUZZLE_SUMMARIES = {
  gen: "ì°½ì„¸ê¸°ëŠ” ì„±ê²½ì˜ ì²« ë²ˆì§¸ ê¶Œìœ¼ë¡œ, í•˜ë‚˜ë‹˜ì´ ì„¸ìƒì„ ì°½ì¡°í•˜ì‹  ì´ì•¼ê¸°ë¡œ ì‹œì‘í•©ë‹ˆë‹¤. ì•„ë‹´ê³¼ í•˜ì™€, ë…¸ì•„ì˜ ë°©ì£¼, ì•„ë¸Œë¼í•¨ê³¼ ì´ì‚­, ì•¼ê³±ê³¼ ìš”ì…‰ì˜ ì´ì•¼ê¸°ë¥¼ í¬í•¨í•˜ë©° ì´ìŠ¤ë¼ì—˜ ë¯¼ì¡±ì˜ ê¸°ì›ì„ ë‹¤ë£¹ë‹ˆë‹¤. ì°½ì„¸ê¸°ëŠ” ì´ 50ì¥ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, ì²œì§€ì°½ì¡°ë¶€í„° ìš”ì…‰ì˜ ì´ì§‘íŠ¸ ìƒì• ê¹Œì§€ë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤.",
  exo: "ì¶œì• êµ½ê¸°ëŠ” ì´ìŠ¤ë¼ì—˜ ë¯¼ì¡±ì´ ì´ì§‘íŠ¸ì˜ ë…¸ì˜ˆ ìƒí™œì—ì„œ í•´ë°©ë˜ëŠ” ê³¼ì •ì„ ê¸°ë¡í•©ë‹ˆë‹¤. ëª¨ì„¸ì˜ ë¦¬ë”ì‹­, ì—´ ê°€ì§€ ì¬ì•™, í™í•´ë¥¼ ê±´ë„ˆëŠ” ê¸°ì , ì‹œë‚´ì‚°ì—ì„œ ì‹­ê³„ëª…ì„ ë°›ëŠ” ì‚¬ê±´ì´ í•µì‹¬ì…ë‹ˆë‹¤. ì¶œì• êµ½ê¸°ëŠ” ì´ 40ì¥ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.",
  lev: "ë ˆìœ„ê¸°ëŠ” ì œì‚¬ì™€ ì œë¬¼, ì œì‚¬ì¥ì˜ ì—­í• , ì •ê²°ë²•ê³¼ ê±°ë£©í•œ ìƒí™œì— ëŒ€í•œ í•˜ë‚˜ë‹˜ì˜ ë§ì”€ì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤. ì´ìŠ¤ë¼ì—˜ ë°±ì„±ì´ ê±°ë£©í•œ ë¯¼ì¡±ìœ¼ë¡œ ì‚´ì•„ê°€ê¸° ìœ„í•œ ìœ¨ë²•ì´ ê¸°ë¡ë˜ì–´ ìˆìœ¼ë©° ì´ 27ì¥ì…ë‹ˆë‹¤.",
  num: "ë¯¼ìˆ˜ê¸°ëŠ” ì‹œë‚´ì‚°ì„ ì¶œë°œí•œ ì´ìŠ¤ë¼ì—˜ì´ ê°€ë‚˜ì•ˆ ì…ì„± ì§ì „ê¹Œì§€ ê²ªì€ ê´‘ì•¼ 40ë…„ì˜ ì—¬ì •ì„ ê¸°ë¡í•©ë‹ˆë‹¤. ì¸êµ¬ ì¡°ì‚¬, ì§€íŒŒë³„ ì—­í• , ë¶ˆìˆœì¢…ê³¼ ì‹¬íŒ, ê·¸ë¦¬ê³  ìƒˆ ì„¸ëŒ€ì˜ ì¤€ë¹„ê°€ í•µì‹¬ ë‚´ìš©ì…ë‹ˆë‹¤. ì´ 36ì¥ì…ë‹ˆë‹¤.",
  deu: "ì‹ ëª…ê¸°ëŠ” ëª¨ì„¸ê°€ ìš”ë‹¨ ë™í¸ì—ì„œ ìƒˆ ì„¸ëŒ€ì—ê²Œ ì „í•œ ì„¤êµì™€ ìœ¨ë²•ì˜ ì¬í•´ì„ì…ë‹ˆë‹¤. ì¶œì• êµ½ì˜ ê¸°ì ì„ ê¸°ì–µí•˜ê³ , ê°€ë‚˜ì•ˆì—ì„œ ì§€ì¼œì•¼ í•  ê³„ëª…ê³¼ ì¶•ë³µê³¼ ì €ì£¼ë¥¼ ë‹´ê³  ìˆìœ¼ë©° ì´ 34ì¥ì…ë‹ˆë‹¤.",
  joh: "ìš”í•œë³µìŒì€ ì˜ˆìˆ˜ ê·¸ë¦¬ìŠ¤ë„ë¥¼ í•˜ë‚˜ë‹˜ì˜ ì•„ë“¤ì´ì ìƒëª…ì˜ ì£¼ë¡œ ì†Œê°œí•©ë‹ˆë‹¤. í‘œì ê³¼ ë§ì”€ì„ í†µí•´ ë¯¿ìŒìœ¼ë¡œ ì˜ìƒì„ ì–»ê²Œ í•˜ëŠ” ëª©ì ì´ ë°í˜€ì ¸ ìˆìœ¼ë©°, ì‚¬ë‘ê³¼ ì§„ë¦¬ì˜ ë©”ì‹œì§€ê°€ ë‘ë“œëŸ¬ì§‘ë‹ˆë‹¤. ì´ 21ì¥ì…ë‹ˆë‹¤.",
  act: "ì‚¬ë„í–‰ì „ì€ ë¶€í™œí•˜ì‹  ì˜ˆìˆ˜ë‹˜ì˜ ëª…ë ¹ì— ë”°ë¼ ì˜ˆë£¨ì‚´ë ˜ì—ì„œ ì‹œì‘ëœ êµíšŒì˜ íƒ„ìƒê³¼ ë°”ìš¸ì˜ ì„ êµ ì—¬ì •ì„ ê¸°ë¡í•©ë‹ˆë‹¤. ì„±ë ¹ ê°•ë¦¼, ì´ˆëŒ€ êµíšŒì˜ ì„±ì¥, ì´ë°©ì¸ ì„ êµê°€ í•µì‹¬ì´ë©° ì´ 28ì¥ì…ë‹ˆë‹¤.",
  rom: "ë¡œë§ˆì„œëŠ” ë³µìŒì˜ í•µì‹¬ì¸ ì˜ë¡­ë‹¤ í•˜ì‹¬ê³¼ ì„±ë ¹ì˜ ì‚¶ì„ ì²´ê³„ì ìœ¼ë¡œ ì„¤ëª…í•˜ëŠ” ë°”ìš¸ì˜ ì„œì‹ ì…ë‹ˆë‹¤. ë¯¿ìŒìœ¼ë¡œ ì˜ë¡­ë‹¤ í•˜ì‹¬ì„ ë°›ê³ , ê·¸ë¦¬ìŠ¤ë„ ì•ˆì—ì„œ ìƒˆ ìƒëª…ì„ ì‚´ì•„ê°€ëŠ” ë‚´ìš©ì„ ë‹´ê³  ìˆìœ¼ë©° ì´ 16ì¥ì…ë‹ˆë‹¤."
};
if (typeof window.PUZZLE_SUMMARIES_EXTRA === 'object') {
  for (var _k in window.PUZZLE_SUMMARIES_EXTRA) { PUZZLE_SUMMARIES[_k] = window.PUZZLE_SUMMARIES_EXTRA[_k]; }
}

function updatePuzzleSummary(quizId, title) {
  var el = document.getElementById('puzzle-summary');
  var titleEl = document.getElementById('puzzle-summary-title');
  var textEl = document.getElementById('puzzle-summary-text');
  if (!el || !titleEl || !textEl) return;
  var prefix = (quizId || '').split('_')[0].slice(0, 3);
  var summary = PUZZLE_SUMMARIES[prefix];
  if (!summary) { el.style.display = 'none'; return; }
  titleEl.textContent = title + 'ë€?';
  textEl.textContent = summary;
  el.style.display = 'block';
}
</script>

<!-- ì •ë‹µë³´ê¸° íŒì—… -->
<div id="adPopup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center;">
  <div style="background: white; padding: 30px; border-radius: 15px; text-align: center; max-width: 420px; width: 90%; box-shadow: 0 10px 25px rgba(0,0,0,0.3);">
    <h2 style="margin-top: 0; color: #0073e6;">ğŸ” ì •ë‹µì„ í™•ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h2>
    <p style="font-size: 15px; line-height: 1.6; color: #333; margin-bottom: 20px;">
      ì •ë‹µ ë³´ê¸°ëŠ” í›„ì›ì ì „ìš© ê¸°ëŠ¥ì…ë‹ˆë‹¤.<br>
      í›„ì›ìê°€ ì•„ë‹ˆì‹œë©´ <b>30ì´ˆ ê´‘ê³  ëŒ€ê¸°</b> í›„ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.
    </p>
    <div id="popupChoice" style="display: flex; flex-direction: column; gap: 10px;">
      <button onclick="location.href='support.html'" style="padding: 15px; background: #0073e6; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">â˜• í›„ì›í•˜ê³  ë°”ë¡œ ë³´ê¸°</button>
      <button onclick="startWaitingTimer()" style="padding: 15px; background: #f0f0f0; color: #555; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">â³ 30ì´ˆ ëŒ€ê¸° í›„ ë¬´ë£Œ ë³´ê¸°</button>
    </div>
    <div id="popupTimerArea" style="display: none; margin-top: 10px;">
      <div style="background: #fff9e6; padding: 20px; border-radius: 10px; border: 1px dashed #ffd43b; margin-bottom: 15px;">
        <p style="margin: 0; color: #856404; font-size: 14px;">"ê¸°ë‹¤ë¦¬ëŠ” ë™ì•ˆ ë§ì”€ êµ¬ì ˆì„ ë¬µìƒí•´ ë³´ì„¸ìš”."</p>
      </div>
      <p id="adTimerText" style="font-size: 18px; font-weight: bold; color: #e63946;">30ì´ˆ í›„ ì •ë‹µì´ ê³µê°œë©ë‹ˆë‹¤</p>
    </div>
    <button onclick="closeAdPopup()" id="closeAdBtn" style="display: none; margin-top: 15px; width: 100%; background: #0073e6; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold;">í™•ì¸ ì™„ë£Œ (ë‹«ê¸°)</button>
  </div>
</div>
</body>
</html>